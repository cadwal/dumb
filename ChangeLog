1999-06-10  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released DUMB 0.13.9.

	* NEWS: Logged changes of DUMB 0.13.9.

	* htic/Makefile.am, doom/Makefile.am (pt_sources): Added font.pt.
	* xwad/xtexture.c: Include "libdumbutil/safem.h".

	* configure.in: Bumped version number to 0.13.9.

1999-06-09  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released DUMB 0.13.8.

	* po/Makefile.in.in: %.po files are now translated first to
	%.po-utf8 and added in the distribution, and only then compiled to
	%.gmo-utf8 or %.mo-utf8.
	(POFILES): Renamed to STD_POFILES.
	(UTF8_POFILES, ALL_POFILES): New variables.
	(DISTFILES): Use $(ALL_POFILES) instead of $(POFILES).
	(GMOFILES): Renamed to ALL_GMOFILES.  All users changed.
	(CATALOGS): Renamed to ALL_CATALOGS.  All users changed.
	(SUFFIXES): Added .po-utf8 and .mo-utf8.
	(.po-utf8.mo-utf8, .po-utf8.gmo-utf8): New rules.
	(.po.po-utf8): Renamed from .po.gmo-utf8.  Don't call $(GMSGFMT).
	Save the output file in the build directory.

	* po/fi.po: Refreshed; no changes in text.

	* docs/Makefile.am, docs/dumb-pt-html/Makefile.am:
	(all-local) [!DUMB_CONFIG_JADE]: Define as a no-op.

	* dumb/unix_net.c: Comment change only.

	* xwad/xtexture.c (xtexture): Call safe_malloc instead of malloc,
	and cast the result to char *.

	* libmissing/hstrerror.c: Include <string.h>.

1999-06-08  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* acinclude.m4 (DUMB_CHECK_TYPE): New macro.
	* aclocal.m4: Regenerated.
	* acconfig.h (socklen_t): New possible macro.
	* configure.in: Look for socklen_t too.

	* libmissing/snprintf.c, libmissing/libmissing.h (vsnprintf,
	snprintf): Renamed "template" argument to "format", which isn't a
	reserved word in C++.

	* po/fi.po: Refreshed; no changes in text.

	* scripts/dumb-lsm.in: Separated SUPPORTS and UNTESTED.

	* acconfig.h (PACKAGE, VERSION): Removed, since Automake generates
	them.

	* configure.in: Check for XInternalConnectionNumbers().
	* xwad/xproto.c [!HAVE_XINTERNALCONNECTIONNUMBERS]: Define
	USE_LONGJMP.
	* xwad/timewait.c [!HAVE_XINTERNALCONNECTIONNUMBERS]: Don't
	compile.

	* configure.in: (DUMB_CONFIG_JADE): New conditional.
	* docs/dumb-pt-html/Makefile.am:
	(all_local) [DUMB_CONFIG_JADE]: Enabled again.
	* docs/Makefile.am (EXTRA_DIST): Added: dumb-pt-index.sgml
	dumb-pt.fixed-index dumb-pt.index
	(all-local) [!DUMB_CONFIG_JADE]: Disabled.
	(dumb-pt-index.sgml): Changed ID from "index" to "genindex".

	* libdumb/sound_mix.c: Comment change only.

	* dumb/unix_net.c (udp_recpkt): Fixed stupid omission (didn't
	compile).

	* po/POTFILES.in: Regenerated.
	* po/fi.po: Regenerated and updated.

	* README: Doc fix.
	* scripts/dumb-lsm.in (Description): Added <wctype.h>, GNU/Hurd
	and libpng.
	(Keywords): Removed graphics.
	(Alternate-Site): X2FTP didn't shut down after all!

	* xwad/timewait.c: Include <string.h>.
	* xwad/drawmap.c: Include <stdlib.h>.

	* test/fixed_bm.c (main): Use rand() and srand() instead of
	random() and srandom().
	* dumb/updthing.c (sector_thing_effect): Ditto.

	* libmissing/snprintf.c, libmissing/hstrerror.c: New files.
	* libmissing/libmissing.h: [!HAVE_HSTRERROR] (hstrerror): New function.
	[!HAVE_SNPRINTF] (vsnprintf, snprintf): New functions.
	* configure.in: Look for towlower() in -lw and abort if not found.
	Provide replacements for snprintf() and hstrerror().
	* libdumb/protoinwad.c, ptcomp/fontcomp.c: Include libmissing.h.

	* libdumbutil/safem.c (safe_vfree): Cast ptr to char*.
	* libdumbutil/safeio.c (safe_unmap): Cast ptr to char*.

	* dumb/unix_net.c: Print all error messages as strings, not
	numbers.
	(SocketDataPtr): New type.
	(udp_init_station): Free bare_name.
	(udp_recpkt): Changed type of sialen from size_t to socklen_t.

	* dumb/unix_net.c (unix_gethostname): Return the hostname as a
	malloced string.  Removed parameters.
	* dumb/net.h (NetDriver::getmyhost): Ditto.
	* dumb/netio.h (net_getmyhost): Ditto.
	* dumb/netio.c (net_getmyhost): Ditto.  If the driver lacks the
	function, return "anonymous" instead of "".
	* dumb/netplay.c (wait_slaveinfo): Adapted to new calling
	convention of net_getmyhost().

	* Makefile.am: Checked the Makefile on Solaris.

1999-06-07  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/safeio.h (safe_mmap): Removed; see the comment.
	(safe_munmap) [!HAVE_MMAP]: Removed.
	* libdumbutil/safeio.c (safe_mmap): Removed.
	(safe_munmap) [!HAVE_MMAP]: Removed.
	[HAVE_MMAP]: Don't print "???" if name==NULL.
	(safe_close): Print "<unknown file>", not "???".

	* libdumbwad/wadio.c (load_wad): Use temporary variable `dir'
	instead of setting `wad->dir' directly.  This avoids a cast.
	* dumb/netplay.c (send_initrequest, send_message, netplay_poll),
	ptcomp/fontcomp.c (fontcomp), xwad/xtexture.c (ROTATE, MIRROR),
	xwad/xwad.c (main), tool/wadtool.c (main): Added explicit casts to
	make C++ happy.

	* libdumb/protoinwad.c, ptcomp/token.c (_GNU_SOURCE): Define this
	feature test macro.
	* dumb/ggi_renoir_video.c (init_video): Removed unused local variable.
	* tool/mkpnames.c: Comment change only.

	* configure.in: Output docs/dumb-pt-html/Makefile too.
	* docs/dumb-pt-html/Makefile.am (EXTRA_DIST): Added
	dumb-pt-html.dsssl.
	(all-local): Commented out.
	(JADE, MOVE_IF_CHANGE): New macros.
	(dumb-pt.html): Use $(MOVE_IF_CHANGE).

1999-06-01  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* acinclude.m4 (DUMB_SCAN_LIBS): Removed; AC_SEARCH_LIBS does the
	same job.
	(DUMB_SEARCH_LIBSETS): New macro.
	* aclocal.m4: Regenerated.
	* configure.in: Try linking aadumb with -lslang, not only
	-lncurses.  And try also with mere -laa.  Use AC_SEARCH_LIBS
	instead of DUMB_SCAN_LIBS.
	(DUMB_AA_LDADD): New substitution.
	* dumb/Makefile.am (aalib_ldadd): Just say $(DUMB_AA_LDADD).

	* libdumbutil/safeio.h: Changed #include to get off_t.

1999-05-30  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* xwad/xwad.h (PI): Removed.
	* xwad/drawmap.c (ARROWA, RIGHTA): Use M_PI, not PI.

	* xwad/tchoose.c (setwmstuff): Get the title in an i18n-friendly way.

	* tool/wadtool.c (print_help, print_version, catwad): Made static.
	(basename): New function.
	(print_version): Updated my copyright.
	(catwad, main): Show source WAD names in progress messages.
	(main): Made LumpNum ln local to each case where it's needed.
	Added plenty of error checking.

	* po/fi.po: Merged with ../po-utf8/fi.po again.
	* po/POTFILES.in: Once again regenerated with *.pt files.
	* po/Makefile.in.in: Merged with ../po-utf8/Makefile.in.in again.
	(RECODE): New variable.
	(UTF8_GMOFILES): New variable.
	(GMOFILES): Added $(UTF8_GMOFILES).
	(STD_GMOFILES): New variable, contains what $(GMOFILES) used to.
	(UTF8_CATALOGS): New variable.
	(CATALOGS): Added $(UTF8_CATALOGS).
	(STD_CATALOGS): New variable, contains what $(CATALOGS) used to.
	(SUFFIXES): Added .gmo-utf8.
	(.po.gmo-utf8): New rule.
	($(srcdir)/$(PACKAGE).pot): Detect keyword U_ too.
	(install-data-yes, uninstall): Use $(STD_CATALOGS), not $(CATALOGS).
	Install and uninstall UTF-8 versions too.
	(update-po): Use $(STD_CATALOGS), not $(CATALOGS).
	* po/.cvsignore: Ignore *.gmo-utf8.
	* po-utf8/: Removed entire directory.
	* Makefile.am (SUBDIRS): Removed po-utf8.
	(update-po): Merged po and po-utf8.
	* configure.in: Removed all traces of po-utf8/.

	* libdumb/dsound.h, libdumb/animtexstruct.h, libdumb/texture.h,
	libdumb/gettableinwad.c, dumb/netplay.h, ptcomp/licomp.c,
	xwad/savemap.c: Commented strange array size.
	* xwad/xproto.c: Scanned for buffer overflows.
	* xwad/xwad.c: Minor reformatting only.
	* tool/pngtodumb.c: Comment change only.
	* dumb/x11_video.c, libdumbwad/wadwr.c: Commented arbitrary limit.
	* dumb/netplay.c: Commented places which look like arbitrary
	limits.
	* dumb/levdata.h: Added a couple of comments in places which need
	attention.

	* dumb/ggi_renoir_video.c (keymap_keycode_to_keyname): printf
	parameter type bugfix.  Bug had no effect on machines where int
	and long are equivalent.

	* libdumbutil/dumb-nls.h (U_): New macro.
	* dumb/gettable.c (draw_count): Use wide characters to avoid
	conversions.
	* dumb/game.c (process_input): Use U_, not _.
	* dumb/dumb.c (main): Bind "dumb-utf8" to LOCALEDIR too.

	* libdumb/font.h, libdumb/font.c (font_text_width): Renamed to
	font_utf8_text_width.
	(font_wc_text_width): New function.
	(font_str_width): Renamed to font_utf8_str_width.
	* dumb/updthing.c, dumb/thinghit.c: A called function had been
	renamed.
	* dumb/message.h (game_vmessage): Renamed to game_utf8_vmessage.
	(game_message): Renamed to game_utf8_message.
	* dumb/message.c (show_local_message): Renamed to
	show_local_utf8_message.
	(dispatch_message): Renamed to dispatch_utf8_message.
	(game_vmessage): Renamed to game_utf8_vmessage.
	(game_message): Renamed to game_utf8_message.
	* dumb/game.h (game_message): Renamed to game_utf8_message.
	* dumb/draw.c, dumb/draw.h (drawtext): Renamed to draw_utf8_text.
	(drawstr): Renamed to draw_utf8_str.
	(draw_wc_text): New function.
	* dumb/banner.h, dumb/banner.c (add_text_to_banner): Renamed to
	add_utf8_text_to_banner.
	(add_str_to_banner): Renamed to add_utf8_str_to_banner.

1999-05-29  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/msgdom.c (init_msgdom) [ENABLE_NLS]: Call bindtextdomain()
	to force the catalog to be read from the same directory as
	dumb.mo.

	* libdumbutil/utf8.c, libdumbutil/utf8.h: New files.
	* libdumbutil/Makefile.am (common_sources): Added utf8.c utf8.h.
	* libdumb/font.c (font_text_width): Use utf8_mbstate_t and
	utf8_mbrtowc() rather than mbstate_t and mbrtowc().
	* dumb/draw.c (drawtext): Use utf8_mbstate_t and utf8_mbrtowc()
	rather than mbstate_t and mbrtowc().
	* dumb/banner.c (add_text_to_banner): Use utf8_mbstate_t and
	utf8_mbrtowc() rather than mbstate_t and mbrtowc().

	* acinclude.m4 (DUMB_C_RESTRICT): New macro.
	* configure.in: Call DUMB_C_RESTRICT.
	* aclocal.m4: Regenerated.

1999-05-27  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* po/POTFILES.in: Regenerated with msgdom.
	* po/fi.po: Refreshed and updated.

	* dumb/gettable.h: Added a comment about having to use dry_run.
	* dumb/updthing.c (pickup_proto): Call pickup_gettables() twice,
	setting dry_run=1 in the first call.
	Use dgettext(get_msgdom(), ...) instead of _(...).

	* dumb/msgdom.h, dumb/msgdom.c: New files.
	* docs/log-classes: Added '_'.
	* dumb/Makefile.am (core_sources): Added msgdom.c msgdom.h.
	* dumb/dumb.c (main): Call init_msgdom().

	* dumb/dumbdefs.pt (GETT_SPC_POWERWEAPONS): No longer NYI.

	* dumb/dos_input.c, dumb/dos_video.c, dumb/vgagl_video.c: Use
	"libdumbutil/dumb-nls.h".
	* test/dwdbtest.c: Minor reformatting so that `make update-po'
	works better.
	* xwad/controls.c, libdumbutil/confhelp.c, dumb/ctlkey.c: Use
	`gettext' rather than `_' for non-constant strings.

	* docs/dumb-pt-index.sgml: Regenerated.

1999-05-26  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.texinfo, docs/dumb-pt.sgml: Documented SpeedUnits,
	MessageDomain and new Gettable special codes.  Now in sync with
	each other.
	* dumb/dumbdefs.pt: Changed comments to match Texinfo documentation.

	* ptcomp/msgdomcomp.c, ptcomp/msgdomcomp.h: New files.
	* ptcomp/Makefile.am (ptcomp_SOURCES): Added msgdompcomp.c
	msgdomcomp.h.
	* ptcomp/ptcomp.c (ptcomp, main, save_ptlumps_in_wadwr):
	Support "MessageDomain".
	* NEWS: Documented `MessageDomain'.

	* htic/monsters.pt, htic/test.pt, htic/ambient.pt, htic/ammo.pt,
	htic/animtex.pt, htic/font.pt, htic/furniture.pt, htic/generic.pt,
	htic/gettables.pt, htic/keys.pt, htic/levels.pt, htic/missiles.pt,
	doom/missiles.pt, doom/monsters.pt, doom/sectortypes.pt,
	doom/weapons.pt, doom/animtex.pt, doom/camera.pt, doom/font.pt,
	doom/furnishings.pt, doom/generic.pt, doom/gettables.pt,
	doom/levels.pt, doom/linetypes.pt: Added copyright comment.
	* htic/weapons.pt: Added copyright comment.
	(PowerUpQty, PowerUpTimeout): Removed now that the tome of power
	is handled properly.
	* htic/htic.pt, doom/doom.pt: Added copyright comment and
	MessageDomain.

1999-05-25  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* NEWS: Logged mmap change.
	* TODO: Added some, removed some.

	* po/fi.po: Again in sync with source.
	* po/POTFILES.in: Regenerated.

	* libdumbwad/wadio.c (DO_BIG_MMAP): Removed.  Now we always try
	big mmap, and if that doesn't work, we read() every lump
	separately.
	(WadFile): Removed members mapalloc and maplen.
	(free_wad): New function.
	(reset_wad): Use free_wad().  Check that nwads becomes 0.
	(load_wad): Removed parameter mapall.  All callers changed.  Use
	safe_lseek() rather than lseek().  Always try to mmap the entire
	WAD, and if that doesn't work, read() the header and let
	loadlump.c to take care of the rest.  Previously, this used
	safe_mmap() if mmap() was detected by `configure'.  This made it
	impossible to fall back to stdio.
	(get_lump_filename): New function.
	(get_lump_map) [!HAVE_MMAP]: Return NULL right away.
	* libdumbwad/wadio.h (get_lump_filename): New function.
	(free_dead_lumps): Removed, since it wasn't used.
	* libdumbwad/loadlump.c (LumpRec): Removed `len' member.  Made
	`data' point to non-const.
	(load_lump): Don't get or set lr->len.  Allocate 1 byte if len==0.
	If mmapping the WAD failed, don't try to mmap the lump.
	(free_lump, free_all_lumps): Use safe_free(), not safe_munmap().
	(release_lump): Changed to a no-op.
	(free_dead_lumps): Removed, since it wasn't used.

	* libdumbutil/safeio.c, libdumbutil/safeio.h (safe_lseek): New
	function.

	* po/fi.po: Updated.

	* libdumbwad/wadio.c: Some comment & formatting changes.

	* libdumbutil/safeio.h (PATH_MAX): Removed.
	* xwad/xwad.c (main): When backing up a WAD, allocate `buf'
	dynamically without relying on PATH_MAX.

	* docs/dumb-pt-index.sgml: Regenerated.

	* NEWS: Logged changes from ChangeLog.

	* docs/dumb-pt.sgml, docs/dumb-pt.texinfo: Documented changes in
	Gets.

1999-05-24  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* ptcomp/protocomp.c (proto_parse_powerup): Use Gets *, not
	ProtoThing_Gets *.
	* ptcomp/gettcomp.c (add_gets): New function.
	(gettcomp): "Ammo" now uses add_gets() instead of ammotype and
	ammocount.  "Gets" added.

	* libdumb/protoinwad.c (ProtoThing_inwad_Gets): Removed type.
	(decode_protoinwad): Call decode_getsinwad_array().
	(encode_protoinwad): Call encode_getsinwad_array().

	* libdumb/gettableinwad.h (Gets_inwad): New type.
	(decode_getsinwad_array, encode_getsinwad_array): New functions.
	* libdumb/gettableinwad.c (struct Gettable_inwad): Replaced
	ammotype and ammocount with ngets and getsofs.
	(ok_lumpver): Incremented version number.
	(struct Gets_inwad): New structure.
	(decode_gettableinwad): Call decode_getsinwad_array() instead of
	copying ammotype and ammocount which were removed.
	(encode_gettableinwad): Call encode_getsinwad_array(), memcpy()
	and safe_free() instead of copying ammotype and ammocount which
	were removed.
	(decode_getsinwad_array, encode_getsinwad_array): New functions.

	* libdumb/prothingstruct.h (ProtoThing_Gets): Removed structure.
	(ProtoThing): Use Gets instead of ProtoThing_Gets.
	* libdumb/gettablestruct.h (Gets): New structure.
	(Gettable): Replaced ammotype and ammocount with ngets and gets.

	* dumb/updthing.c (pickup_proto): Don't loop, just call
	pickup_gettables().

	* dumb/gettable.c (player_has_enough_ammo): Renamed to
	has_enough_ammo().  Takes a pointer to the gettable, not its index
	number.  All callers changed.  Rewritten to use
	pickup_gettables().
	(would_be_useless): New function.
	(use_selection): Don't use the item if would_be_useless() returns
	true.  Decrement ammo via pickup_gettables(), not directly.
	(pickup_gettable): Collected TYPE, NUM and MAX parameters to a
	Gets structure.  Added DRY_RUN.  All callers changed.  Totally
	rewrote internals to support gets->change<0.
	(pickup_gettables): New function.

	* dumb/gettable.h (enum gettable_pickup): Redesigned now that
	amounts can be negative.
	(GETT_PU_YES): Replaced by GET_PU_IS_OK and GETT_PU_IS_USEFUL.
	(pickup_gettable): Collected TYPE, NUM and MAX parameters to a
	Gets structure.  Added DRY_RUN.  All callers changed.
	(pickup_gettables): New function.

	* dumb/useitem.c (use_item): Always return 1 if GK_SPESELECT is set.
	* dumb/game.c (process_input): Allow using items.

	* scripts/dumb-lsm.in: X2FTP is down.

	* libdumbutil/align.h (ALIGN_PROTOTHING_GETS): Removed.
	(ALIGN_GETS): New macro.

	* htic/gettables.pt: Gettables now give other gettables!

	* doom/weapons.pt: Give ammo first, weapon last.

1999-05-23  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/gettable.c (set_gettcount): Select weapons automatically.
	Refresh weapon bogothing if GETT_SPC_POWERWEAPONS is gained or
	lost.
	(player_has_enough_ammo): New function, used in a number of
	places.

	* libdumbutil/safem.c (valloc_mmap): Set valloc_method=VALLOC_MMAP
	if mmap() succeeds.

	* dumb/gettable.c (PLINFOPOS_POWERWEAPONS): New constant.
	(PLINFO_POWERWEAPONS): New macro.
	(GETT_ID_OK): New macro.
	(getcount): Renamed to gettcount_ptr.  No longer used directly.
	Handle GETT_SPC_POWERWEAPONS.
	(gettcount, set_gettcount): New functions.
	(set_bogot): Check PLINFO_POWERWEAPONS(pl).
	(rotate_selection): Compare ammo count to what the weapon needs,
	not to 1.
	(use_selection): Don't emit sound if shooting fails.  Treat all
	non-zero values returned by use_item() identically.
	(update_gettables): Don't do anything if count<0 already.

	* libdumb/gettablestruct.h (Gettable): Added powered_bogotype.
	* libdumb/gettableinwad.h (Gettables_inwad): New structure.
	(first_gettableinwad, begin_gettablesinwad): New functions.
	(decode_gettableinwad_array): Changed const Gettable_inwad *src to
	const Gettables_inwad *hdr.  Added lumpname parameter.
	* libdumb/gettableinwad.c (Gettables_inwad): New structure.
	(Gettable_inwad): Added powered_bogotype member.
	(ok_lumpver): New constant.
	(first_gettableinwad, begin_gettablesinwad): New functions.
	(decode_gettableinwad): First clear DEST.  Copy powered_bogotype.
	(encode_gettableinwad): Copy powered_bogotype.
	(decode_gettableinwad_array): Now takes a pointer to the header,
	not to the first block.
	* ptcomp/gettcomp.c (gettcomp): Support powered_bogotype via
	"PoweredBogotype".  Default to bogotype.
	(wrgetts): Write the header first.
	* dumb/gettable.c (init_gettables): decode_gettableinwad_array
	parameters changed.

	* libdumb/lumpver.h, libdumb/lumpver.c: New file.
	* libdumb/fontmapinwad.c, libdumb/fontinwad.c: Use LumpVer instead
	of ad-hoc code.
	* libdumb/Makefile.am (libdumb_a_SOURCES): Added lumpver.c
	lumpver.h.

	* htic/weapons.pt (PhaseTable HeldChargedStaff, Proto
	HeldChargedStaff): Renamed to HeldPoweredStaff.
	(Proto HeldStaff, Proto HeldPoweredStaff): Raised AimArc from 0deg
	to 10deg.
	(PhaseTable HeldChargedGauntlets, Proto HeldChargedGauntlets):
	Renamed to HeldPoweredGauntlets.
	(Gettable Staff, Gettable Gauntlets): Added PoweredBogoType.
	(Gettable ChargedStaff, Gettable ChargedGauntlets): Removed.

	* dumb/dumbdefs.pt (GETT_SPC_SPECIALSHOOT): Replaced by
	GET_SPC_POWERWEAPONS.
	* htic/gettables.pt (Gettable ActiveTomeOfPower): Use
	GETT_SPC_POWERWEAPONS, not GETT_SPC_SPECIALSHOOT.

	* TODO: Added some, removed some, rearranged some.

1999-05-22  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* NEWS: Logged changes from ChangeLog.

	* configure.in: Warn if libpng is missing.

1999-05-18  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in (DUMB_CONFIG_LIBPNG): New conditional.
	* tool/Makefile.am (png_bin_programs): New variable.
	(bin_programs): Include $(png_bin_programs), not directly
	pngtodumb.

1999-05-16  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/safem.h (safe_vmalloc, safe_vcalloc, safe_vfree)
	[!HAVE_MMAP]: Define as functions, not macros.
	* libdumbutil/safem.c (safe_realloc): Warn if new size is 0.
	(safe_calloc): Moved cast outside multiplication.
	(valloc_method): New variable.
	(valloc_mmap): New function.
	(safe_vcalloc): Delegate most work to valloc_mmap().
	(safe_vmalloc): New function.  Used to be a macro calling
	safe_vcalloc().
	(safe_vfree): Check valloc_mmap and possibly call safe_free().

	* po/POTFILES.in: Regenerated.
	* po/fi.po: Synced with changes in GGI support.

	* dumb/ggi_degas_video.c, dumb/ggi_olddegas_video.c: Replaced by
	ggi_renoir_video.c.
	* dumb/ggi_renoir_video.c: Renamed from ggi_degas_video.c and
	updated.
	* configure.in (DUMB_GGI_SOURCES): Don't substitute in Makefiles.
	Support only Renoir and check GII_KT_LATIN1 rather than
	GII_PBUTTON_PRIMARY or GGI_KEY_ENTER.
	* dumb/Makefile.am (ggi_objs): Removed.
	(ggidumb_SOURCES): Replaced $(DUMB_GGI_SOURCES) with
	ggi_renoir_video.c.
	(EXTRA_ggidumb_SOURCES): Removed ggi_olddegas_video.c
	ggi_degas_video.c.
	(ggidumb_LDADD, ggidumb_DEPENDENCIES): Removed $(ggi_objs).

	* test/Makefile.am, test/dwdbtest.c, test/ldltest.c: Renamed
	ldltest to dwdbtest as planned.

	* libdumbwad/wadwr.c, libdumbworldb/hexenwad.h,
	libdumbworldb/doomwad.h: Comment fix.

	* dumb/Makefile.am (aalib_ldadd) [!DUMB_CONFIG_X]: Don't add
	$(x_ldadd).

	* docs/dumb-pt-index.sgml, docs/dumb-pt-html/Makefile.am,
	docs/dumb-pt-html/dumb-pt-html.dsssl: New files.
	* docs/Makefile.am (SUBDIRS): Added . and dumb-pt-html.
	(book1.html): Removed.  Now handled in dumb-pt-html/.
	(all-local): New target.
	(COLLATEINDEX): New variable.
	($(srcdir)/dumb-pt-index.sgml, $(srcdir)/dumb-pt.fixed-index): New
	targets.
	* docs/.cvsignore: Ignore dumb-pt.fixed-index and dumb-pt.index.
	* docs/dumb-pt-html/.cvsignore: New file.  Ignore Makefile.in.

	* Makefile.am (SUBDIRS): Added po-utf8.
	(MOVE_IF_CHANGE): New variable.
	(update-po): Support po-utf8.  Moved *.pt messages to it.
	* configure.in: Update po-utf8/Makefile.in.in and
	po-utf8/Makefile.in.
	* po-utf8/Makefile.in.in: New file, mostly copied from
	../po/Makefile.in.in.
	* po-utf8/POTFILES.in: New file.
	* po-utf8/fi.po: Moved *.pt messages here from ../po/fi.po.
	* po-utf8/.cvsignore: New file, copied from ../po/.cvsignore.
	* po/POTFILES.in: Regenerated without *.pt files.
	* po/fi.po: Moved *.pt messages elsewhere.

	* scripts/move-if-change: New file, copied from EGCS.
	* scripts/Makefile.am (EXTRA_DIST): Added move-if-change.

	* README: Several updates.

1999-04-22  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.sgml: Removed PART element around index.
	(generated-index): Changed system ID from "genindex.sgml" to
	"dumb-pt-index.sgml".
	(part-intro, part-reference): Added ID attribute.

1999-04-18  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.sgml: Now in sync with Texinfo version.  Added a
	machine-generated index, although it doesn't have Makefile support
	yet.

	* docs/dumb-pt.texinfo: Minor doc fix.

1999-04-14  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* NEWS: Logged newest ptcomp changes.

	* ptcomp/parm.c (default_speed_units): New variable.
	(change_speed_units): New function.
	(speed_units): Multiply with default_speed_units, not
	default_speed.
	* ptcomp/parm.h (change_speed_units): New function.
	* ptcomp/ptcomp.c (ptcomp): Parse "SpeedUnits".

	* libdumb/font.c (dotless): New function.
	(font_wchar): Try with dotless().
	(font_wchar_texref): Call font_wchar_nofallback(), not
	font_wchar().
	
	* libdumb/font.c (POSSIBLY_BAD_TOWLOWER): New macro.
	(dumb_towlower) [POSSIBLY_BAD_TOWLOWER]: New function.
	(font_wchar): [POSSIBLY_BAD_TOWLOWER] Use dumb_towlower(), not
	towlower().
	* README: Explained towlower() bug.

	* libdumb/font.h, libdumb/font.c (set_font_wchar_descent): New
	function.
	* ptcomp/fontcomp.c (fontcomp): Implemented "Descent".
	* TODO: "Descent" works now.

	* htic/monsters.pt, htic/missiles.pt, htic/furniture.pt: Converted
	proto speeds to parm_speed() format.

	* po/fi.po: Changed the translations of several Heretic objects.

	* dumb/dumb.c: Changed one #include.

1999-04-13  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.texinfo: Added section about Fonts.

	* po/POTFILES.in: Regenerated.
	* po/fi.po: Translated everything I could.

	* ptcomp/fontmapcomp.c (wrfontmap): Number of font mappings is
	unsigned, so print it with "%5u" not "%5d".

	* ptcomp/ptcomp.c (ptcomp): Call fontmapcomp() on "FontMapping".
	(main): Call init_fontcomp() and init_fontmapcomp().
	(save_ptlumps_in_wadwr): Call wrfontmap().
	* ptcomp/fontcomp.c (nfonts): New variable.
	(init_fontcomp): Clear nfonts.
	(fontcomp): Increment nfonts.  Implemented everything except
	"Descent".
	(wrfonts): Print names of all fonts on the same line.
	* TODO: FONTINFO is now ready, although not with that name :)

	* ptcomp/parm.h (parm_num): Replaced with new functions parm_int
	and parm_uint.
	(parm_int_opt, parm_ulong): More new functions.
	* ptcomp/parm.c (parse_long, parse_ulong): New functions.
	(time_units, speed_units, arc_units): Changed parameter order.
	Parameter S must now already point after the digits in the string,
	so use it without skipping digits.
	(parm_ch): Don't suggest `--fake-strings' if name has multiple
	characters.
	(parm_num): Replaced with parm_int() and parm_uint().  Moved
	actual parsing to parse_long() and parse_ulong() which use
	strtol() and strtoul() instead of atoi().
	(parm_num_opt): Renamed to parm_int_opt().  Use parse_long(), not
	atoi().
	(parm_ulong): New function.
	(parm_time, parm_speed, parm_arc, parm_arc_opt): Use parse_long(),
	not atoi().
	(speed_units): Multiply with default_speed if no unit.
	* ptcomp/soundcomp.c, ptcomp/ltcomp.c, ptcomp/gettcomp.c,
	ptcomp/animcomp.c, ptcomp/protocomp.c: Changed all occurrences of
	parm_num() to parm_int() or parm_uint().

	* ptcomp/token.c (synerr): Used to print context information in a
	separate line.

	* ptcomp/protocomp.c (proto_parse_physics): Get "Speed" with
	parm_speed(), not parm_num()<<12.

	* libdumb/protoinwad.c (protoinwad_strdup): Make sure the string
	doesn't extend past the end of the block.

	* libdumb/fontmap.h (FontMap): New type.
	(game_fontmap): New variable.
	(load_mapped_font): Added const FontMap * parameter.
	(new_fontmap, fontmapping, set_fontmapping, fontmap_length): New functions.

	* libdumb/fontinwad.c (load_font): Set delimiter lump names to
	NULL if they would otherwise be empty strings.

	* dumb/gettable.c (init_gettables), dumb/message.c (init_message):
	Added game_fontmap to call of load_mapped_font.

	* dumb/dumb.c (BANNER): Print "DUMB", not PACKAGE which is "dumb".
	(print_program_version): Copyright 1999 Kalle Niemitalo.
	(main): Use DUMB_CONFIG_DOOM_DIR and DUMB_CONFIG_HERETIC_DIR, not
	..._PATH.  Initialize game_fontmap.

	* doom/weapons.pt (Proto HeldChainsaw): Made farther reaching.
	There was another Proto HeldChainsaw in this file; removed that.
	* doom/monsters.pt: Changed all speeds from N to N00/sec and
	increased melee damages.
	* doom/missiles.pt: Changed all speeds from N to N00/sec, except
	ClassicMissile, Missile and Bullet to only half of that.
	* doom/font.pt: Comment change only.

	* ptcomp/fontmapcomp.c, ptcomp/fontmapcomp.h,
	libdumb/fontmapinwad.h, libdumb/fontmapinwad.c: New files.
	* libdumb/Makefile.am (libdumb_a_SOURCES): Added fontmapinwad.c
	fontmapinwad.h.
	* ptcomp/Makefile.am (ptcomp_SOURCES): Added fontmapcomp.c
	fontmapcomp.h.
	* libdumb/fontmap.c: Moved loading and saving to fontmapinwad.c.
	Now supports multiple fontmaps.

	* README: Various updates.

1999-04-11  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* ptcomp/fontcomp.h, ptcomp/fontcomp.c: New files.
	* ptcomp/Makefile.am (ptcomp_SOURCES): Added fontcomp.c and
	fontcomp.h.
	* ptcomp/ptcomp.c (ptcomp): Added "Font" keyword.
	* ptcomp/parm.h, ptcomp/parm.c (parm_num_opt): New function.

	* libdumb/fontmap.h (load_mapped_font): Made parameter unsigned.

	* libdumb/fontmap.c: Terminology change: "map entry" -> "mapping"
	* htic/font.pt, doom/font.pt: Changed FontMap to FontMapping.

	* libdumb/fontinwad.h, libdumb/fontinwad.c: New files.
	* libdumb/Makefile.am (libdumb_a_SOURCES): Added fontinwad.c and
	fontinwad.h.

	* libdumb/font.h (load_font): Moved to fontinwad.h.
	(new_font, get_font_delimlumps, font_wchar_texref,
	font_foreach_wchar, set_font_delimlumps, set_font_wchar_texref,
	set_font_separation, set_font_space_width): New functions.
	* libdumb/font.c (FontChar): Added middle state where the texture
	name is known but the texture has not been located.
	(free_font): Check tex.name in addition to tex.lumpnum.
	(font_wchar_tex): Look up the lump if not done yet.
	(add_font_wchar): Clear entire FontChar structure.
	(font_wchar_nofallback): Check tex.name, not tex.lumpnum.
	(FontChar_inwad, ok_magic, ok_version, Font_inwad, load_font):
	Moved to fontinwad.c.
	(Font): Added members after and before.
	(free_font): Free new members too.
	(font_wchar_width, font_wchar_nofallback, font_wchar): Added
	prototypes.
	(new_font, get_font_delimlumps, font_wchar_texref,
	font_foreach_wchar, set_font_delimlumps, set_font_wchar_texref,
	set_font_separation, set_font_space_width): New functions.

	* dumb/x11_video.c (get_input): Log strange events with
	LOG_WARNING, not LOG_ERROR.

	* docs/maint/dumb-autoins.el: Moved to ../../scripts/
	* docs/maint/Makefile.am (EXTRA_DIST): dumb-autoins.el is no
	longer here.

	* aux/: Renamed directory to scripts/ to avoid MS-DOS reserved name.
	* configure.in, Makefile.am (SUBDIRS, rpm_in, lsmin): Renamed aux/
	directory to scripts/.

1999-04-04  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* htic/htic.pt: Added "font.pt"
	* htic/font.pt: Comment changes only.  :)
	* doom/font.pt: Removed parameters after conversionless formats.
	* doom/doom.pt: Added "font.pt"

	* dumb/draw.c, dumb/draw.h (drawtext, drawstr): Made font
	parameter point to const.

	* dumb/message.c (message_font): Changed type from int to Font*.
	(init_message): Use load_mapped_font(), not init_font().
	(get_xhair_texture): Return NULL if message_font is missing.
	(show_local_message): logprintf the message if message_font is
	missing.

	* dumb/gettable.c (count_font): Changed type from int to Font*.
	(init_cfont): Removed function.
	(draw_count): Don't try to initialize count_font; just return if
	it's missing.  Convert digits to ASCII.
	(init_gettables): Load count_font.  Use LUMPNAMELEN.
	(reset_gettables): Free count_font.

	* libdumb/fontmap.h, libdumb/fontmap.c: New files.
	* libdumb/Makefile.am (libdumb_a_SOURCES):
	Added fontmap.c and fontmap.h.
	* dumb/dumbdefs.pt: Added include guard.
	(FONTMAP_GETTABLECOUNT, FONTMAP_MESSAGE, FONTMAP_MENU): New
	constants.
	* htic/font.pt, doom/font.pt: Map fonts via <dumb/dumbdefs.pt>
	constants, not keywords.

	* dumb/banner.h (add_text_to_banner, add_str_to_banner): Changed
	font parameter type to const Font *.
	* dumb/banner.c (add_wchar_to_banner): New function.
	(add_text_to_banner, add_str_to_banner): Changed parameter int
	font to const Font *font.
	(add_text_to_banner): Reimplemented with <wchar.h>.

	* dumb/draw.c (textwidth, strwidth): Renamed to font_text_width
	and font_str_width in font.c.
	(drawtext, drawstr): Reimplemented with <wchar.h>.
	* dumb/draw.h (textwidth, strwidth): Renamed to font_text_width
	and font_str_width in font.h.
	(drawtext, drawstr): Change font parameter to Font* and moved it.

	* libdumb/texture.c (guess_sprite_size): Exported.
	* libdumb/texture.h (guess_sprite_size): Exported.

	* libdumb/font.c (LUMPNAMELEN): Moved to libdumbwad/wadio.h, where
	it hopefully belongs.
	(Font): Added members separation and space_width.
	(ok_magic, ok_version): New constants.
	(Font_inwad): Added members magic, version, separation,
	space_width, after and before.
	(add_font_char): Renamed to add_font_wchar.
	(load_font): Check and copy new members of Font.  Print init
	message.  Call guess_sprite_size() on character shapes.
	(get_font_char): Renamed to font_wchar_tex.  Moved pointer
	traversal to font_char_nofallback and font_char.  Previous version
	didn't try case conversions either.
	(font_separation, font_space_width, font_wchar_width): New
	functions.
	(font_text_width, font_str_width): Renamed from textwidth and
	strwidth in draw.h.  Reimplemented with <wchar.h>.
	* libdumb/font.h (get_font_char): Renamed to font_wchar_tex.
	(font_separation, font_space_width): New functions.
	(font_text_width, font_str_width): Renamed from textwidth and
	strwidth in draw.h.

	* libdumbwad/wadio.h (LUMPNAMELEN): New constant.
	* libdumbwad/wadio.c, libdumbwad/wadstruct.h, libdumbwad/wadwr.c,
	libdumb/gettablestruct.h, libdumb/gettableinwad.c, dumb/netplay.c,
	dumb/animtex.c, libdumb/texture.c: Use LUMPNAMELEN.
	* libdumb/levinfostruct.h (LevInfo): Suggest using LUMPNAMELEN.

	* configure.in: Added AC_REPLACE_FUNCS(strnlen)
	* libmissing/strnlen.c: New file, adapted from glibc-2.1.1pre1.
	* libmissing/libmissing.h: New file.
	* libmissing/Makefile.am (libmissing_a_SOURCES): Added libmissing.h.
	(libmissing_a_LIBADD): New variable.

1999-04-03  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumb/texture.h, libdumb/texture.c: Removed all font stuff.
	* libdumb/Makefile.am (libdumb_a_SOURCES): Added font.c and
	font.h.
	* libdumb/font.h, libdumb/font.c, htic/font.pt, doom/font.pt: New
	files.
	* docs/log-classes: Added 'F'.

1999-03-31  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* TODO: Added some, removed some.
	* NEWS: Logged latest news.

	* tool/ppmtodumb.c (print_help, print_version): Corrected some
	messages.
	* tool/pngtodumb.c: New file, adapted from ppmtodumb.c.
	* tool/Makefile.am (bin_PROGRAMS): Added pngtodumb.
	(png_ldadd, pngtodumb_LDADD): New variables.

	* libdumbwad/Makefile.am: Formatting change only.

	* libdumb/Makefile.am (libdumb_a_SOURCES): Sorted.

	* htic/gettables.pt (Proto BagOfHolding): Give some ammo.
	* htic/htic.pt: Moved ammo before gettables, because Bag of
	Holding must give ammo.

	* dumb/message.c (init_message): Check whether lump STCFN065
	exists; if not, use "FNLA%04X" which is in dumb-game.
	* libdumb/texture.c (get_font_texture_internal): Renamed from
	get_font_texture and removed recursion.
	(get_font_texture): Delegate work to get_font_texture_internal.

1999-03-29  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumb/texture.c: Added form feeds.
	(PName): New structure.
	(pnames): Changed char* to PName*.
	(init_pnames, lookup_pname): Changed pnames+9*i to &pnames[i].
	(init_pnames): Don't print what npnames "should be" unless it is
	different.
	(init_patches, get_patch_data): Use lookup_pname(num)->name rather
	than lookup_pname(num) or pnames+num*9.

1999-03-23  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* TODO: Yet another update.

	* htic/monsters.pt (Proto Imp, Proto ImpLeader, Proto Mummy, Proto
	MummyLeader, Proto Knight): Tweaked hit points to match
	experiences with real Heretic.
	(Proto GhostMummy, Proto GhostMummyLeader, Proto GhostKnight):
	Guessed hit points from the above.

	* htic/monsters.pt (PhaseTable IronLich): Changed default duration
	to 200msec.  Added Shoot.
	(Proto IronLich): Added Mass, Shoots, SeeArc and AimArc.  Raised
	Speed from 5 to 8.  Now it seems about right.

	* htic/missiles.pt (PhaseTable ClawZap): NoSigs when already
	exploding.

	* libdumb/protoinwad.c, libdumb/prothingstruct.h: Comment fixes
	only.

	* libdumb/gettableinwad.h, libdumb/gettableinwad.c: New files.
	* libdumbutil/align.h (ALIGN_GETTABLE): New macro.
	* libdumb/Makefile.am (libdumb_a_SOURCES): Added gettableinwad.c
	and gettableinwad.h.
	* libdumb/gettablestruct.h (Gettable): Use native format.
	Serialization is now handled by gettableinwad.c.
	* ptcomp/gettcomp.c (wrgetts): Use encode_gettableinwad() instead
	of dumping the structure directly.  Don't print newline until
	finished.
	* dumb/gettable.c (gettable_ln): Moved inside init_gettables().
	(ngetts): Renamed to ngettables.  All users changed.
	(getts): Renamed to gettables, dropped one level of indirection
	and made point to non-const.  All users changed.
	(scan_gettables): Removed.
	(init_gettables): Warn if no gettables.  Use
	decode_gettableinwad_array() instead of scan_gettables().  Free
	the "GETTABLE" lump.
	(reset_gettables): Don't free the "GETTABLE" lump;
	init_gettables() does that.

1999-03-22  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* NEWS: Logged most important changes from ChangeLog.

	* htic/test.pt (Proto test-STFF, Proto test-GAUN, Proto test-FX05,
	Proto test-FX07, PhaseTable HeadTyphoon, Proto HeadTyphoon, Proto
	test-KGZ1, Proto test-SMPL, Proto test-FBMB, Proto test-SPMP):
	Removed, since real protos now exist.

	* htic/gettables.pt (Gettable TimeBomb, Gettable MapScroll,
	PhaseTable TimeBomb, Proto TimeBomb, Proto MapScroll): New.
	(Gettable ActiveShadowsphere, Gettable ShadowSphere): Moved icons
	32 pixels up.
	(Gettable QuartzFlask): Moved icon to right side.  Raised
	DefaultMaximum from 9 to 30.
	(Proto BagOfHolding, Proto MorphOvum, Proto Torch, Proto
	ShadowSphere, Proto CrystalVial, Proto QuartzFlask, Proto
	WingsOfWrath, Proto RingOfInvincibility, Proto SilverShield, Proto
	TomeOfPower): Removed Mass.
	(Proto MorphOvum): Don't glow.

	* htic/weapons.pt (PowerUpQty, PowerUpTimeout): Copied from
	gettables.pt.
	(PhaseTable HeldStaff, PhaseTable HeldChargedStaff, Proto
	HeldStaff, Proto HeldChargedStaff, PhaseTable HeldGauntlets,
	PhaseTable HeldChargedGauntlets, Proto HeldGauntlets, Proto
	HeldChargedGauntlets, Gettable Staff, Gettable ChargedStaff,
	Gettable ChargedGauntlets): New.
	(Gettable Gauntlets): Added BogoType HeldGauntlets.
	(Proto Gauntlets, Proto Crossbow, Proto DragonClaw): Added
	PickupMessage.

	* htic/missiles.pt (PhaseTable IronLichMissileShard, Proto
	IronLichMissileShard, PhaseTable IronLichMissile, Proto
	IronLichMissile, PhaseTable IronLichTyphoon, Proto
	IronLichTyphoon): New.
	* htic/furniture.pt (Proto KeyGizmoHolder): New.

	* htic/ammo.pt: New file, separated from gettables.pt.
	* htic/gettables.pt (Gettable WandCrystals, Gettable
	EtherealArrows, Gettable ClawOrbs, Proto CorpseWandAmmo, Proto
	WimpyWandAmmo, Proto HeftyWandAmmo, Proto WimpyBowAmmo, Proto
	HeftyBowAmmo, Proto WimpyClawAmmo, Proto HeftyClawAmmo): Moved to
	ammo.pt.
	* htic/Makefile.am (pt_sources): Added ammo.pt.

	* configure.in, INSTALL: Removed --disable-8bpp, --disable-16bpp
	and --disable-32bpp options.
	* acconfig.h (DUMB_CONFIG_8BPP, DUMB_CONFIG_16BPP,
	DUMB_CONFIG_32BPP): Removed.
	* dumb/dumb.c (main), dumb/fbrerend.h, dumb/generic_fbrerend.c,
	dumb/le32_fbrerend.c, dumb/le64_fbrerend.c: Removed
	DUMB_CONFIG_8BPP, DUMB_CONFIG_16BPP and DUMB_CONFIG_32BPP
	conditions.  The rendering functions are now unconditionally
	compiled.
	* dumb/Makefile.am (render_objs): Removed.
	(core_sources): Replaced "$(DUMB_RENDER_SOURCES)" with "render8.c
	render16.c render32.c".
	(extra_sources): Removed render*.c.
	(LDADD, dependencies): Removed $(render_objs).

	* dumb/renderc.h (render, render_walls, calc_view_constants):
	Added casts to make C++ happy.
	(render_walls): Possibly call safe_realloc() with a NULL argument.
	* dumb/rendflat.h (flatx_loop): Added casts to make C++ happy.

	* ptcomp/protocomp.c (protocomp): Chopped in tiny little pieces.
	(proto_parse_phases, proto_parse_appearance, proto_parse_pain,
	proto_parse_attack, proto_parse_ai, proto_parse_powerup,
	proto_parse_physics, proto_parse_misc): New functions.  Code taken
	from protocomp().

	* ptcomp/protocomp.c (protocomp): Grouped keywords by meaning.
	Renamed "TurnWhenHitting" to "TurnOwner" and "BulletKludge" to
	"BecomesBlood".  Deprecated "Flying" in favor of "CanFly".  Added
	"Boss".
	* libdumb/prothingstruct.h: Aligned #defines, added plenty of
	zeros and untabified.
	(PT_FAST_SHOOTER): Removed.
	(PT_BULLET_KLUDGE): Renamed to PT_BECOMES_BLOOD.
	(PT_TURNWHENHITTING): Renamed to PT_TURN_OWNER.
	* dumb/thingm.c (do_strategy): Replaced PT_FAST_SHOOTER with
	PT_NASTY which it was defined as anyway.  PT_TURNWHENHITTING is
	now called PT_TURN_OWNER.
	* dumb/bangbang.c (thing_shoot_single): PT_BULLET_KLUDGE is now
	called PT_BECOMES_BLOOD.
	* htic/missiles.pt (Proto WandZap), doom/missiles.pt (Proto
	Bullet): `BulletKludge' is now called `BecomesBlood'.
	* doom/weapons.pt (Proto HeldChainsaw): `TurnWhenHitting' is now
	called `TurnOwner'.

	* htic/monsters.pt: Renamed all *Head protothings and phasetables
	to *IronLich.

	* dumb/updthing.c (update_things): Check PT_YMOVE_ONLY.

	* AUTHORS: More credits to me :)

1999-03-21  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumbdefs.pt: Marked NYI features.
	(GETT_SPC_SPECIALSHOOT, GETT_SPC_WINGS): New constants.
	* htic/gettables.pt (FloatUpAndDown, CountAsItem): New macros.
	(Proto Torch): Added FloatUpAndDown and CountAsItem.
	(Proto CrystalVial): Added FloatUpAndDown.
	(Gettable Health): Renamed to Gettable Life.
	(Gettable Shield, Proto SilverShield, Gettable BagOfHolding, Proto
	BagOfHolding, Gettable MorphOvum, Proto MorphOvum, Gettable
	ActiveShadowsphere, Gettable Shadowsphere, Proto Shadowsphere,
	Gettable ActiveWingsOfWrath, Gettable WingsOfWrath, Proto
	WingsOfWrath, Gettable ActiveRingOfInvincibility, Gettable
	RingOfInvincibility, Proto RingOfInvincibility, Gettable
	ActiveTomeOfPower, Gettable TomeOfPower, Proto TomeOfPower): New.
	(Gettable WandCrystals, Gettable EtherealArrows, Gettable
	ClawOrbs): Halved DefaultMaximum.  The previous values are
	available WithBackpack.
	(Gettable Torch): Changed icon from TRCHA0 to ARTITRCH.  Moved
	IconPos from "160 8" to "16 -48 XCenter".  Added SpeSel and Ammo.
	(Gettable QuartzFlask): Added Icon, IconPos and SpeSel.
	(Proto QuartzFlask): Gets QuartzFlask, not Health.  Added
	FloatUpAndDown.
	(Proto HeftyClawAmmo): It's called "energy orb", not "power orb".
	* htic/keys.pt: Moved all key icons 10 pixels to the right.

	* htic/Makefile.am (pt_sources): Added test.pt.
	* htic/test.pt: New file.
	* htic/htic.pt: Include "test.pt".

	* htic/monsters.pt (PhaseTable DeadHead, Proto DeadHead,
	PhaseTable Head, Proto Head): New.

	* htic/furniture.pt (Proto WallTorch): Removed "A" from Sprite
	"WTRHA".

	* dumb/gettable.c (draw_count): Center the count horizontally
	around X.
	(draw_gettables): Handle centering flags differently if the
	coordinate is negative.  Don't allocate screen space for the count
	even if oy<0.
	* dumb/draw.h (drawtext): Changed LEN parameter from int to
	size_t.
	(textwidth, strwidth): New functions.
	* dumb/draw.c (drawtext): Changed LEN parameter from int to
	size_t.
	(textwidth, strwidth): New functions.
	(DRAWSPEC): Added whitespace.  No longer automatically prepends
	"draw" to function name.
	(drawo1, drawo2, drawo4): Renamed to drawoutl1, drawoutl2,
	drawoutl4.

	* dumb/game.c (process_input): Fixed bidirectional item selection.

1999-03-20  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.sgml: Added FPI.

	* htic/gettables.pt (Gettable Health): Dropped maximum from 200 to
	100.
	(Gettable WandCrystals, EtherealArrows, ClawOrbs): Doubled
	maximums from 100, 50 and 200.
	(Gettable Torch): Raised maximum from 1 to 9.
	(Gettable QuartzFlask): New.
	(Proto CorpseWandAmmo): New.
	(Proto WimpyWandAmmo): Gets WandCrystals 10, not 4.
	(Proto HeftyWandAmmo): Gets WandCrystals 50, not 10.
	(Proto WimpyBowAmmo): Gets EtherealArrows 5, not 4.
	(Proto HeftyBowAmmo): Gets EtherealArrows 20, not 10.
	(Proto WimpyClawAmmo): Gets ClawOrbs 10, not 20.
	* htic/weapons.pt (Gettable Wand, Crossbow, DragonClaw,
	Gauntlets): Added weapon numbers.
	(Proto Crossbow): Give some ammo.
	* htic/monsters.pt (Proto MummySpirit): Spawn CorpseWandAmmo, not
	WimpyWandAmmo.

	* docs/maint/contrib.html: Comment fix.

	* configure.in, NEWS: Bumped version to 0.13.8.

1999-03-19  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released DUMB 0.13.7.

	* po/fi.po: Refreshed (no changes in text)

	* Makefile.am (rpmrelease): Renamed variable to rpm_release.
	(rpmstem): Renamed variable to rpm_stem.
	(rpmspec): Renamed variable to rpm_spec.
	(rpmin): Renamed variable to rpm_in.

	* po/POTFILES.in: Regenerated.
	* po/fi.po: Translated some more.

	* xwad/xtexture.c (rotate, mirror): Renamed to upper case and
	added plenty of whitespace.

	* libdumb/prothingstruct.h (ProtoThing_inwad_Gets,
	ProtoThing_inwad): Moved to protoinwad.c.
	* libdumb/protoinwad.c (ProtoThing_inwad_Gets, ProtoThing_inwad):
	Moved from prothingstruct.h.
	* libdumb/protoinwad.h (ProtoThing_inwad): Declare as opaque.

	* dumb/linux_video.c (init_video), dumb/levdata.c (apply_update),
	ptcomp/parm.c (parm_strdup), ptcomp/protocomp.c (protocomp),
	xwad/controls.c (init_cseti): Added explicit casts for C++.
	* xwad/choose.c (chksize, choosedhf, sb_motion), xwad/controls.c
	(ctldhf): Added local variable chinst.  Use it instead of INFO.
	* xwad/timewait.c (timeval_subtract): ANSIfied.
	* xwad/xproto.c: Added #include "libdumb/protoinwad.h".
	(init_instance): Removed obsolete variables.

	* htic/Makefile.am (htic4dum.wad): Added missing backslash.

1999-03-18  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* TODO: Unlisted features which have been implemented :)
	and added some missing ones :(

	* htic/gettables.pt (PowerUpQty, PowerUpTimeout): Copied from
	../doom/gettables.pt.
	(Gettable ActiveTorch): Added DefaultMaximum and PowerUpTimeout.
	(Proto CrystalVial, QuartzFlask): Added PickupMessage.

	* doom/Makefile.am (d4d_sources): Renamed variable to pt_sources.
	(d4d_wad): Renamed variable to pt_wad.  Also changed filename to
	pt.wad.
	(d4d_lumps): Renamed variable to other_lumps.
	(playpal_src_wad): New variable.
	(PLAYPAL.lump): Use $(playpal_src_wad).
	* htic/Makefile.am: Mostly rewritten to match ../doom/Makefile.am.

	* htic/Makefile.am (pt_preprocess): Use $(CPP), not $(CXXCPP).  We
	no longer support // comments.
	($(h4d_pt_lumps)): Don't use -DHERETIC; htic.pt takes care of that
	now.
	* htic/htic.pt: Added #include <dumb/dumbdefs.pt>.  Include the
	other files with "", not <>.
	(HERETIC): Define here, not in Makefile.
	* htic/gettables.pt: Adapted to new ptcomp.
	(Gettable Health): Use GETT_SPC_HEALTH rather than 1.
	(Gettable ActiveTorch): Added.
	(Proto WimpyWandAmmo, HeftyWandAmmo, WimpyBowAmmo, HeftyBowAmmo,
	WimpyClawAmmo, HeftyClawAmmo): Added messages.
	* htic/generic.pt, htic/animtex.pt, htic/ambient.pt,
	htic/monsters.pt, htic/missiles.pt, htic/levels.pt, htic/keys.pt:
	Adapted to new ptcomp.
	* htic/weapons.pt, htic/furniture.pt: Adapted to new ptcomp and
	replaced // with /* */.

	* configure.in: Removed AC_PROG_CXXCPP.  Bug fix: Replaced
	DUMB_SOUND references with DUMB_CONFIG_SOUND.
	* doom/Makefile.am (pt_preprocess): Use $(CPP), not $(CXXCPP).  We
	no longer support // comments.
	($(d4d_pt_wad)): Don't use -DDOOM; doom.pt takes care of that now.
	* doom/doom.pt (DOOM): Define here, not in Makefile.
	* doom/monsters.pt, doom/linetypes.pt, doom/gettables.pt: Changed
	// comments to /* */.

	* libdumb/texture.c (init_font): Don't try upper-case versions --
	that's now in get_font_texture.
	(get_font_texture): Try upper-case version on failure.  Made
	missing chars non-fatal.
	* dumb/banner.c (add_text_to_banner): Substitute a space if
	get_font_texture returns NULL.
	* dumb/game.c (process_input): Added font test in key 7.

	* dumb/thinghit.c (thing_hit_wall): Added some braces for clarity.
	* dumb/netplay.c (send_sync): Added explicit int for last_ack.
	* dumb/gettable.c (count_font): Added explicit int.
	* dumb/le32_fbrerend.c (fbrerender8, fbrerender16, fbrerender32):
	Added explicit ints.
	* libdumbutil/confdef.h (CONFITEM_END, CONFENUM_END): List all
	members.
	* dumb/unix_net.c (netdriver): Changed {NULL} to {NULL,}.

	* libdumb/Makefile.am: Removed $(DUMB_CONFIG_SOUND)_sound.c from
	libdumb_a_SOURCES and added the corresponding .o in
	libdumb_a_DEPENDENCIES and libdumb_a_LIBADD.  This avoids a bug in
	GNU Make 3.77.

	* tool/mkdfnt.c (main): Bug fix: did not print argv0.
	* tool/mkpnames.c (print_help): Printed one argv0 too many.

	* libdumbutil/safeio.c (safe_read): Retry after EINTR or short
	read.

1999-03-14  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumb/protoinwad.h, libdumb/protoinwad.c
	(decode_protoinwad_array): New function.
	* xwad/xproto.c (init_instance): Use decode_protoinwad_array().
	* libdumb/prothing.c (init_prothings): Use
	decode_protoinwad_array().

	* docs/README.ptcomp: Added Gettable.SpawnMax.

	* NEWS: Added armour damage.

1999-03-13  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.texinfo, docs/dumb-pt.sgml: Mostly documented
	Level.

	* docs/dumb-pt.sgml: Reindented with step 1.

1999-03-11  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-pt.texinfo, docs/dumb-pt.sgml: Doc fix.

	* docs/dumb-pt.texinfo, docs/ptcomp.texinfo: Renamed
	ptcomp.texinfo to dumb-pt.texinfo.
	* docs/dumb-pt.sgml, docs/ptcomp.sgml: Renamed ptcomp.sgml to
	dumb-pt.sgml.
	* docs/Makefile.am (EXTRA_DIST): Added dumb-pt.sgml.
	(info_TEXINFOS): Renamed ptcomp.texinfo to dumb-pt.texinfo.
	(book1.html): Renamed ptcomp.sgml to dumb-pt.sgml.
	* docs/.cvsignore: ptcomp.info renamed to dumb-pt.info.

1999-03-10  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* NEWS: Synchronized.

	* libdumb/prothingstruct.h (ProtoThing, ProtoThing_inwad): Added
	member spawnmax.
	* dumb/bangbang.c (MAX_SPAWNCOUNT): Removed.  The number can now
	be set separately for each ProtoThing.
	* libdumb/protoinwad.c (decode_protoinwad, encode_protoinwad):
	Copy spawnmax.
	* ptcomp/protocomp.c (protocomp): Initialize spawnmax at 5 and
	allow changing it with "SpawnMax".

	* ptcomp/token.c (unget_token): Barf if called twice in a row.

	* po/fi.po: Updated, although untranslated entries still remain.

	* libdumbwad/wadio.h: Added #include "libdumbutil/log.h".
	* libdumbutil/log.h (logvprintf): Added __attribute__.

	* libdumb/texture.c (init_font): If a lower-case character is
	missing, try the upper-case one.

	* dumb/thingm.c (thing_take_damage): Handle temporary
	invulnerability and armour.

	* dumb/gettable.c (getcount): Assert validity of type.
	(init_plinfo): Bugfix: count to ngetts, not to
	PLINFOPOS_GETTCOUNTS.
	(use_selection): Renamed cd to itemptr and cb to ammoptr.  Don't
	initialize them until PLINFO_SEL is valid.
	* dumb/updthing.c (pickup_proto): Bugfix: get gets[i], not
	gets[0].
	* doom/gettables.pt (PowerUpQty): Increased tenfold.
	(Gettable Backpack): Added DefaultMaximum 1.
	* ptcomp/protocomp.c (set_phid): Use a loop rather than memcpy().
	* libdumb/protoinwad.c (encode_protoinwad): Use safe_calloc()
	rather than safe_malloc().

	* dumb/message.c, dumb/message.h: New files.  Contents ripped from
	dumb.c and game.c.
	* dumb/Makefile.am (core_sources): Added message.c and message.h.
	* dumb/game.c (game_vmessage, game_message): Moved to message.c.
	* dumb/dumb.c (banner): Replaced by message_banner in message.c.
	(wbanner): Replaced by waffle_banner in message.c.
	(bfont): Replaced by message_font in message.c.
	(do_gmsg): Replaced by show_local_message() in message.c.
	(gmsg): Replaced by dispatch_message() in message.c.
	(main): Renamed txh to tex_xhair.  Initialise it via
	get_xhair_texture().  Moved banner initialisation to
	init_message() in message.c.

	* dumb/dumbdefs.pt (PROTO_ID_CAMERA): New constant.
	* dumb/dumb.c (main), doom/camera.pt (Proto Camera): Use
	PROTO_ID_CAMERA rather than 8888.

	* doom/dumbdefs.pt: Moved to ../dumb/.
	* dumb/dumbdefs.pt: Moved from ../doom/.
	* dumb/Makefile.am (pkginclude_HEADERS): New variable.
	* doom/doom.pt: Take dumbdefs.pt from dumb/
	* doom/Makefile.am (pt_preprocess): Added -I$(top_srcdir) because
	of <dumb/dumbdefs.pt>.

	* docs/ptcomp.texinfo: Added @direntry.
	(EDITION, UPDATED, VERSION): Now taken from version.texi.
	* docs/.cvsignore: Ignore stamp-vti and version.texi.
	* aux/texinfo.tex: Added from Automake distribution.
	* aux/Makefile.am (EXTRA_DIST): Added texinfo.tex.

	* ptcomp/token.c (synerr): Use class_of_token() and handle EOF
	tokens.
	(getc_or_perror, synerr, err): Use DUMB_EXIT_ constants.

	* ptcomp/token.h (TokenClass): New enum.
	(class_of_token): New function.
	* ptcomp/token.c (class_of_token): New function.
	* ptcomp/parm.c (parm_str, parm_strdup, parm_name, parm_ch,
	parm_num, parm_dbl, parm_time, parm_speed, parm_arc,
	parm_arc_opt): Use class_of_token().

	* ptcomp/globals.h (fake_strings_flag): New variable.
	* ptcomp/ptcomp.c (fake_strings_flag): New variable.
	(show_help): Show --fake-strings.
	(main): Deprecated-usage message recommends --output-directory
	rather than the short form -d.  Parse --fake-strings.
	* ptcomp/parm.c (parm_str, parm_strdup, parm_ch): Accept name
	tokens if fake_strings_flag is true.

	* libdumbutil/align.h (ALIGN_PROTOTHING, ALIGN_PROTOTHING_GETS):
	New constants.  * libdumb/protoinwad.c (encode_protoinwad): Use
	ALIGN macro from "libdumbutil/align.h" instead of the static
	align().
	(align): Removed function.

1999-03-09  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* ptcomp/protocomp.c (wrprotos): Call encode_protoinwad() to
	convert the ProtoThing to external format.  Free the converted
	blocks.

	* libdumb/mme_sound.c, libdumb/linux_sound.c, dumb/x11_video.c,
	dumb/rendcommon.c, dumb/linetype.h, dumb/linetype.c,
	dumb/keyname.h, dumb/keyname.c, dumb/keymapdummy.c,
	dumb/keymapconf.h, dumb/keymapconf.c, dumb/keymap.h,
	dumb/keymap.c, dumb/dumb.c, dumb/ctlkey.h, dumb/ctlkey.c,
	dumb/aalib_video.c, dumb/aalib_input.c, docs/maint/source.html,
	docs/maint/dumb-autoins.el, docs/maint/contrib.html,
	libdumbutil/align.h, libdumb/sound_mix.h, libdumb/sound_mix.c,
	libdumbutil/confeng.h, libdumbutil/confeng.c,
	libdumbutil/dumb-nls.h, tool/wadtool.c, tool/mknulmap.c,
	tool/mkdfnt.c, tool/dark2trans.c, test/ldltest.c, test/fixed_bm.c,
	libdumbworldb/thingsec.c, libdumbworldb/savedoom.c,
	libdumbworldb/prop.c, libdumbworldb/private.h,
	libdumbworldb/observer.c, libdumbworldb/loaddoom.c,
	libdumbworldb/lineprop.c, libdumbworldb/isok.c,
	libdumbworldb/initfini.c, libdumbworldb/hexenwad.h,
	libdumbworldb/findsec.c, libdumbworldb/dummyvtbl.c,
	libdumbworldb/dumbworldb.hh, libdumbworldb/dumbworldb.h,
	libdumbworldb/doomwad.h, libdumbworldb/difficulty.c,
	libdumbworldb/detach.c, libdumbworldb/del.c,
	libdumbworldb/alloc.c, libdumbutil/safem.h, libdumbutil/safeio.h,
	libdumbutil/safeio.c, libdumbutil/log.h, libdumbutil/intset.h,
	libdumbutil/intset.c, xwad/xwad.c, xwad/xproto.c: Removed my
	middle initial.
	* libdumbutil/bugaddr.h, libdumbutil/bugaddr.c,
	libdumb/protoinwad.h, libdumb/protoinwad.c,
	libdumbutil/copyright.h, libdumbutil/copyright.c,
	libdumbutil/exitcode.h, xwad/timewait.h, xwad/timewait.c: Removed
	my middle name.

	* po/fi.po: Translated some more strings.

	* ptcomp/token.c (synerr): Don't print the token directly if it is
	a newline.

	* po/POTFILES.in: Regenerated.
	* po/fi.po: Mostly updated.  Untranslated entries still remain,
	though.

	* libdumb/protoinwad.h: New file.
	* libdumb/protoinwad.c: New file.  Most functions stolen from
	prothing.c.
	* libdumb/prothingstruct.h: Moved in-memory structures before
	in-WAD structures.
	(Protos_inwad): Renamed to ProtoThing_inwad.
	(Protos_inwad_Gets): Renamed to ProtoThing_inwad_Gets.
	* libdumb/prothing.c (is_proto): Moved to is_protoinwad() in
	protoinwad.c.
	(next_proto): Moved to next_protoinwad() in protoinwad.c.
	(protothing_strdup): Moved to protoinwad_strdup() in protoinwad.c.
	(load_proto): Moved to decode_protoinwad() in protoinwad.c.
	* libdumb/Makefile.am (libdumb_a_SOURCES): Added protoinwad.c and
	protoinwad.h.

	* docs/ptcomp.texinfo (Tokens): Some C-style backslash escapes
	have been implemented.
	(Tokens, N_): N_ should not be used so hastily.
	* docs/ptcomp.sgml (doc-cpp-invocation, doc-gettext-lib,
	doc-gettext-xgettext): Use "<texinfo>" rather than "Info:".  No
	idea which one is correct.
	(sect-tokens): Some C-style backslash escapes have been
	implemented.
	(sect-tokens, sect-n): N_ should not be used so hastily.

1999-03-08  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* ptcomp/ptcomp.c (show_help): Must print argv0 twice.

	* NEWS: Logged from ChangeLog.

	* xwad/xproto.h (struct AppInstance): ProtoThing pointer cannot be
	to const.

	* ptcomp/protocomp.c (ProtoThingRec): Changed char name[NAMELEN]
	to char *name.
	(protocomp): Use parm_name() to get the name of the Proto.  Unget
	the token after the name if it wasn't the ID.  Added
	"PickupSound", "FirstPickupMessage", "PickupMessage" and
	"IgnoreMessage".  "FastShoot" prints a warning message.  Multiple
	"Gets" are allowed and properly stored, and each may be followed
	by "Maximum".
	(wrprotos): Write to WADWR, not to FILE.
	(parm_proto): Use parm_name().  Use err() rather than synerr().
	(chkuniqueid): Use err().

	* doom/levels.pt: Quoted level, music and sky names.  Removed
	Secret pointers which were the same as Next.
	* doom/weapons.pt, doom/monsters.pt, doom/missiles.pt: Quoted all
	sprites and their phases.
	* doom/gettables.pt: Quoted all sprites, icons and animation mode
	characters.  Removed PickupSounds from Gettables.
	* doom/generic.pt: Quoted all sprite phases.
	* doom/furnishings.pt: Quoted all sprite names.
	* doom/camera.pt (PhaseTable Camera): Quoted sprite phase.

	* ptcomp/ptcomp.c (ptcomp): Don't give NULL to synerr().
	(print_help): Print -o before -d because it's better.
	(main): Parse -o before -d.

	* ptcomp/phasecomp.h (ThingPhaseRec): Replaced char *tpname with
	char **tpnames.  Changed char name[NAMELEN] to char *name.
	* ptcomp/phasecomp.c (phasecomp): ThingPhaseRec::tpname is now
	tpnames and is allocated differently.  Use parm_name().  Convert
	phase name "-" to NULL.
	(parm_ph_tbl): Use parm_name().  Use err() rather than synerr().
	(parm_phase): Use parm_name().  Don't compare NULL pointers in
	tpnames.  Use err() rather than synerr().

	* ptcomp/parm.h (parm_keyword_opt): New function.
	* ptcomp/parm.c (parm_str): Print maximum length in error message.
	(parse_string): Print invalid sequence in error message.
	(parm_name): Disallow string tokens.
	(parm_keyword_opt): New function.
	(speed_units): Suggest new syntax in warning message.  Use warn().
	* ptcomp/ltcomp.c (ltcomp): Use parm_name(), parm_num() and err().
	(ltacomp): Use parm_name().
	(ltcomp, parm_termmtype, atolumptype, atoeventtype): Capitalized
	and enhanced error messages.
	* ptcomp/licomp.c (licomp): Use parm_str().
	(wrlinfos): SECRET defaults to NEXT, not to empty.
	* ptcomp/gettcomp.c (gettcomp, parm_gett): Capitalized error
	messages.
	(gettcomp."DefaultMaximum"): Use parm_keyword_opt().
	* ptcomp/soundcomp.c (soundcomp): Use parm_name().  Print
	MAX_REDIR_SOUNDS in error message.
	(parm_sound): Use parm_name().

	* ptcomp/token.h (warn): New function.
	(synerr, err): Made variadic and added format attribute.
	* ptcomp/token.c (next_token, parse_hash_line): Tweaked error
	messages.
	(warn): New function.
	(err, synerr): Made variadic.  Print the formatted parameters
	instead of old fixed "syntax error" and "fatal error" strings.
	synerr() prints token after error message, not before.
	* ptcomp/parm.c: Capitalized all error messages as in GNU
	standard.
	(parm_ch): Require a string of length 1.
	(parm_arc_opt): Unget the token if it doesn't match.
	(arc_units): Print a warning if the obsolete syntax is used.
	* ptcomp/animcomp.c (animcomp): Use parm_name().  Print more
	detail on erroneous "To".

	* ptcomp/gettcomp.c (wrgetts): Write proper padding in the file.

	* ptcomp/parm.h, ptcomp/parm.c (parm_name): New function.
	* ptcomp/gettcomp.c (GettableRec): Don't limit name length to
	NAMELEN.
	(gettcomp): Use parm_name().  Removed "GotThe", "GotA",
	"PickupSound", "AddAmmo" and "Message".  Renamed "Local" to
	"OneMapOnly" and "Sound" to "UseSound".  Renamed "Collect" to
	"DefaultMaximum" and added optional "WithBackpack".  Replaced
	"UseNum" with new required parameter of "Ammo".
	(parm_gett): Use parm_name() rather than next_token().  Don't
	allow ID references.

	* libdumb/prothing.c: Removed all BUILT_IN_XLUMPS and proto_phases
	stuff which was already ifdeffed or commented out.

	* libdumb/prothingstruct.h: Made the PROTOS lump consist of
	variable-length blocks.
	(Protos_inwad_Gets): New structure.
	(Protos_inwad): Used to be called ProtoThing.  Removed _spare1 and
	_spare2 because the structure can now be easily extended.
	Replaced artitype and artinum with ngets and getsofs.  Other new
	members: pickup_sound, firstpickupmsgofs, pickupmsgofs,
	ignoremsgofs.
	(ProtoThing_Gets, ProtoThing): New structures.
	* libdumb/prothing.c: PROTOS lump now consists of variable-length
	blocks which are converted to internal format at startup.  Changed
	all ProtoThing pointers to non-const.
	(proto_ln): Moved inside init_prothings().
	(sprites): Replaced by ProtoThing::sprites.
	(get_sprite_table): Use pr->sprites rather than
	sprites[pr-protos].
	(reset_prothings): Free the objects pointed to by each ProtoThing.
	(is_proto, next_proto, protothing_strdup, load_proto): New
	functions.
	(init_prothings): Convert the protos to internal format and free
	the lump.

	* ptcomp/token.c (next_token): Append a quote to each string
	token.
	* ptcomp/token.h: Commented.

	* ptcomp/parm.c (parm_str): Require a real string parameter, not
	just a name.
	(parm_strdup, parse_string): New functions.
	(parm_num, parm_dbl, parm_time, parm_speed, parm_arc,
	parm_arc_opt): Barf if the token is a string.
	(parm_msg): Removed.
	* ptcomp/parm.h (parm_strdup): New function.
	(parm_msg): Removed.

	* ptcomp/ltcomp.c (wrlts, wrsts): Call wadwr_lump.
	* ptcomp/licomp.c (wrlinfos): Call wadwr_lump.
	* ptcomp/animcomp.c (wranims): Call wadwr_lump.
	* ptcomp/phasecomp.c (wrphases): Call wadwr_lump.
	* ptcomp/soundcomp.c (wrsounds): Call wadwr_lump.
	* ptcomp/ptcomp.c (save_ptlumps_in_wadwr): Greatly simplified.
	* ptcomp/gettcomp.h, ptcomp/gettcomp.c (wrgetts): Write to WADWR,
	not FILE.
	* ptcomp/protocomp.h (wrprotos): Write to WADWR, not FILE.

	* libdumbutil/strgrow.h: Commented.
	(strgrow_strdup_clear): New function.
	* libdumbutil/strgrow.c (strgrow_strdup_clear): New function.

	* ptcomp/token.c (cppfile): Replaced by finname which allows
	filenames of any length.
	(begin_file): Assert.  Allocate finname dynamically.
	(end_file): Function used to be empty.
	(print_error_prefix, synerr, err): Print to stderr.
	(line): Changed type from int to unsigned long.
	(print_error_prefix): Print line number with "%lu", not "%d".
	(tokbuf): Use struct strgrow instead of fixed-size array.
	(getc_or_perror, parse_hash_line): New functions.
	(next_token): Thoroughly rewritten.  This version understands
	quoted strings and allows '#' in tokens, except as first
	character.

1999-03-07  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	I actually made most of these changes last week, but didn't check
	them in until now.

	* dumb/levdyn.h (ThingDyn): proto pointer is now non-const.
	* dumb/dumb.c (do_preload): ProtoThing pointers can no longer be
	const.
	* libdumb/prothing.h: ProtoThing pointers are no longer const.

	* libdumbwad/wadio.c (load_wad): Try to cope with
	corrupted/truncated WAD files whose directory doesn't fit in.

	* libdumbutil/safem.c (safe_vcalloc): Renamed fd to devzerofd.
	(safe_malloc): Formatting changes only.  Really!

	* libdumb/gettablestruct.h: Made the GETTABLE lump consist of
	variable-length blocks.
	(GK_MSG_LEN): Killed.
	(Gettable): Added block_length.  Renamed bulletkind and usenum to
	ammotype and ammocount.  Removed bulletadd, string and
	pickup_sound.  Replaced collect with defaultmax and backpackmax.
	Renamed sound to usesound.
	(GK_GOT_THE, GK_GOT_A): Removed.
	(GK_LOCAL): Renamed to GK_ONEMAPONLY.
	* dumb/gettable.h (enum gettable_pickup, GETT_PU_YES): New.
	(pickup_gettable): Added parameter MAX.  Return enum
	gettable_pickup, not void.
	* dumb/gettable.c (ln): Renamed to gettable_ln.
	(gett): Used to point to an array of Gettables; now it points to
	an array of pointers to Gettables.  All references changed.
	(PLEXTRA): Replaced by PLINFOPOS_GETTCOUNTS.
	(PLINFOK): Renamed to PLINFO_OK.
	(PLCOUNT): Removed in favor of getcount().
	(PLSEL): Renamed to PLINFO_SEL.
	(PLINFO_BACKPACK): New macro.
	(getcount): Use constants from <dumbdefs.pt>.  Added backpack.
	(gettmax, scan_gettables): New functions.
	(init_plinfo): Split parameter in two.  Use *getcount(ld, pl, i)
	rather than pli[i + PLEXTRA].  This makes sure specials go to the
	right counters.
	(pickup_gettable): Returns code numbers instead of emitting sounds
	and messages directly.
	(draw_gettables): Use gettmax(ld, pl, i) instead of gt->collect.
	(cheat_gettables, reset_local_gettables, gettable_chk_key): Use
	getcount().
	(init_gettables): Use scan_gettables() and fancier allocation.
	(reset_gettables): Free the gettable pointer array too.  Reset
	gettable_ln to invalid, just in case.
	* dumb/updthing.c (pickup_proto): New function.
	(thing_chk_collide): Use pickup_proto() instead of
	pickup_gettable().

	* dumb/levdata.h: init_plinfo now takes two arguments.
	* dumb/levdata.c (init_player): Pass ld argument to init_plinfo().

	* doom/dumbdefs.pt: First version.
	* doom/doom.pt: Using "foo.pt" rather than <foo.pt> in #includes,
	except for the newly added <dumbdefs.pt>.

	* libdumbwad/wadwr.h (WADWR): New member error_flag.
	(wadwr_close): Returns int, not void.
	* libdumbwad/wadwr.c (wadwr_open, wadwr_close, wadwr_lump,
	wadwr_write): Set w->error_flag on errors.
	(wadwr_close): Return w->error_flag.
	* ptcomp/ptcomp.c (show_help): Added --output-wad=WADFILE.
	(show_version): Updated copyrights.
	(main): Support --output-wad=WADFILE.  Moved actual saving in
	helper functions.
	(save_ptlumps_in_dir, save_ptlumps_in_wad, save_ptlumps_in_wadwr):
	New functions.
	* ptcomp/soundcomp.h, ptcomp/soundcomp.c, ptcomp/phasecomp.h,
	ptcomp/phasecomp.c, ptcomp/animcomp.h, ptcomp/animcomp.c,
	ptcomp/ltcomp.h, ptcomp/ltcomp.c, ptcomp/licomp.c,
	ptcomp/licomp.h: Write to WADWR, not FILE.
	* doom/Makefile.am: Using new WAD-writing mode of ptcomp.
	Previously each lump was in a separate file.
	(wadtool, ppmtodumb, ptcomp): Changed variable names to upper
	case.

	* docs/ptcomp.texinfo, docs/ptcomp.sgml: New files.
	* docs/.cvsignore: Ignore ptcomp.info.
	* docs/Makefile.am (info_TEXINFOS, book1.html): Added.
	* docs/README.ptcomp: Added notice about new doc files.
	(Proto.Gets): Takes optional Maximum.
	(Gettable.GotThe, Gettable.GotA, Gettable.Message): Replaced by
	FirstPickupMessage, PickupMessage and IgnoreMessage in Proto.
	(Gettable.PickupSound): Moved in Proto.
	(Gettable.Local): Renamed to OneMapOnly.
	(Gettable.Collect): Renamed to DefaultMaximum.  Added optional
	WithBackpack.
	(Gettable.AddAmmo): Replaced by multiple Gets.
	(Gettable.Usenum): Replaced by required parameter of Ammo.
	(Gettable.Ammo): New <count> parameter replaces UseNum.
	* doom/weapons.pt, doom/gettables.pt: Adapted Gettables and their
	Protos to new system; see the changes of ../docs/README.ptcomp.

	* TODO: Backpack and radiation-immune monsters have been
	implemented.

	* Makefile.am (update-po): Scan *.pt too.  Use "\0"-terminated
	strings between find and xargs.
	* po/POTFILES.in: Regenerated.
	* po/fi.po: Regenerated but not yet manually filled in.

1999-02-27  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in: Removed AC_OUTPUT_COMMANDS, since AM_GNU_GETTEXT
	takes care of po/Makefile.

1999-01-26  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* NEWS: Logged the changes below.

	* xwad/timewait.h, xwad/timewait.c: New files.
	* docs/log-classes: Added 'X'.
	* xwad/Makefile.am (XProtoThing_SOURCES): Added timewait.c and
	timewait.h.
	* xwad/xproto.c [!USE_LONGJMP]: Use xnextevent_before() instead of
	jumping out of XNextEvent() via a SIGALRM handler.

	* configure.in: Look for both <ppm.h> and <gr/ppm.h>, and #define
	the result in DUMB_CONFIG_PPM_H in config.h.  Reported by Rubens
	Ramos Fernandes Junior <rubens_ramos@yahoo.com>.
	(DUMB_PPM_LDADD): Fixed a typo which caused it not to be properly
	cleared.  It defaulted to empty, though.
	* acconfig.h (DUMB_CONFIG_PPM_H): Added.
	* tool/dark2trans.c, tool/ppmtodumb.c: #include DUMB_CONFIG_PPM_H
	rather than <ppm.h>.

	* aclocal.m4: Regenerated with aclocal 1.4.

	* configure.in (DUMB_CONFIG_HERETIC_DIR): Take dirname from
	${DUMB_CONFIG_HERETIC_WAD}, not ${DUMB_CONFIG_DOOM_WAD}.
	Reported by Rubens Ramos Fernandes Junior <rubens_ramos@yahoo.com>.

1999-01-15  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in: Added comment about AC_CHECK_SIZEOF.

	* po/fi.po: Synchronized line numbers.

	* libdumbutil/conffile.c (save_conf): Added TRANS comment.

	* configure.in: Bumped version number to 0.13.7.
	* NEWS: Added entry for DUMB 0.13.7.

1999-01-06  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released DUMB 0.13.6.

	* docs/Install-FAQ: Doc fix.
	* docs/patches/gettext-0.10.35-1-po-regexp.diff,
	docs/patches/gettext-0.10.35-2-intllibs.diff,
	docs/patches/gettext-0.10.35-3-memcpy.diff,
	docs/patches/gettext-0.10.35-4-comments.diff,
	docs/patches/gettext-0.10.35-5-destdir.diff,
	docs/patches/gettext-0.10.35-6-mkinstalldirs.diff: Added a
	copyright disclaimer of some sort.

	* docs/patches/gettext-0.10.35-7-gnusource.diff: New file.
	* docs/patches/Makefile.am (EXTRA_DIST): Added
	gettext-0.10.35-7-gnusource.diff.
	* intl/ChangeLog, intl/dcgettext.c: New versions from
	gettext-0.10.35.kn.7.

	* NEWS: Logged changes in DUMB 0.13.6.
	* configure.in: Bumped version number to 0.13.6.

	* dumb/things.h (camera_to_view, update_camera): Added prototypes.

	* xwad/xproto.c (main): Hook and unblock SIGALRM before calling
	setitimer() or alarm().
	* TODO: Added XProtoThing core dump notice.
	* po/fi.po: Line number changes only.

1999-01-05  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* xwad/xproto.c (main): Treat non-option arguments as
	--load-wad=FILE.
	(print_help): Adjusted accordingly.
	* po/fi.po: Synchronized with source and added 1999 to copyright.

	* TODO: Merged some items and added ALSA.

1999-01-03  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* xwad/xproto.c, xwad/xwad.c (main): Log to stderr rather than
	stdout.  Log LOG_WARNING and higher even when !verbose_flag.

1998-12-28  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* xwad/xwad.c (main): --verbose sets verbose_flag to 1, not 0.
	Treat non-option arguments as WAD files to load.
	(print_help): WADFILE arguments are allowed.
	
	* xwad/xtexture.h, xwad/xtexture.c, xwad/controls.h,
	xwad/controls.c, xwad/connect.c, xwad/choose.h, xwad/choose.c,
	dumb/x11_video.c: ,s/\([A-Z][a-z]\+ \*\) /\1/g
	* docs/maint/indent.pro: Added -TDisplay and -TXFontStruct.

	* xwad/connect.c, xwad/xwad.c, xwad/xwad.h:
	,s/USE_LIBDUMBLEVEL/DUMB_CONFIG_LDWB/g

	* libdumbutil/bugaddr.c (print_bugaddr_message): Print <> around
	program_bug_address.

1998-12-27  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in: Restored ggiParseMode() check.
	(DUMB_GGI_LDADD): Removed, since "-lggi" is always enough.
	* dumb/Makefile.am (ggi_ldadd): Use -lggi instead of
	$(DUMB_GGI_LDADD), which no longer exists.

	* xwad/xproto.c (main): Exit loop when c==-1, not when c==1.
	Reported by Jan Rocho.

1998-12-25  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released DUMB 0.13.5.

	* configure.in (DUMB_GGI_LDADD): Use -lggi, not -ggi.
	(AM_INIT_AUTOMAKE): Bumped version number to 0.13.5.
	* NEWS: Updated version number.

1998-12-22  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released DUMB 0.13.4.

	* aux/dumb-lsm.in: GGI is Degas.  Changed x2ftp directory.

	* Makefile.am ($(distdir).lsm): Use $(PACKAGE)-$(VERSION) rather
	than $(distdir).
	(kn-dist): Made lsm dependency a separate command.

	* dumb/ggi_dali_video.c: Renamed to ggi_olddegas_video.c, since it
	didn't really work with Dali.
	* dumb/Makefile.am (EXTRA_ggidumb_SOURCES): Adapted.
	* configure.in: Adapted.  Warn if GGI is old.

	* Makefile.am (update-po): Sort the list of filenames.
	* po/POTFILES.in: Regenerated.  Now in alphabetical order.
	* po/fi.po: Synchronized with source.

	* .cvsignore: Don't ignore aclocal.m4 because building it from
	scratch may require installing many packages, including patched
	versions of gettext.
	* aclocal.m4: Once again in CVS.

1998-12-20  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* po/POTFILES.in: Regenerated to scan new GGI files.
	* po/fi.po: Refreshed.  No change in actual messages.

	* dumb/Makefile.am, dumb/ggi_dali_video.c, dumb/ggi_degas_video.c,
	dumb/ggi_video.c: Renamed ggi_degas_video.c to ggi_dali_video.c
	and ggi_video.c to ggi_degas_video.c.  I had misunderstood the
	versions.
	* configure.in: Assume the GGI libraries are there if the headers
	exist.  Define DUMB_GGI_SOURCES and DUMB_GGI_LDADD rather than
	DUMB_GGI_VERSION.  Eliminated $dumb_have_ggi.
	* dumb/Makefile.am (ggi_objs): New variable.
	(ggi_ldadd): Use $(DUMB_GGI_LDADD).
	(ggidumb_SOURCES): Use $(DUMB_GGI_SOURCES) rather than
	ggi_$(DUMB_GGI_VERSION)_video.c.
	(ggidumb_LDADD, ggidumb_DEPENDENCIES): Added $(ggi_objs).
	* NEWS: Document GGI Degas support.

1998-12-19  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/ggi_video.c: New version from Andrew Apted.  Uses GII.
	* dumb/ggi_degas_video.c: Copy of previous version of ggi_video.c.
	* configure.in: Moved framebuffer bits near the beginning.
	Support two GGI versions.
	* dumb/Makefile.am (ggidumb_SOURCES, EXTRA_ggidumb_SOURCES):
	Choose between ggi_video.c and ggi_degas_video.c.

1998-12-18  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/patches/gettext-0.10.35-6-mkinstalldirs.diff,
	docs/patches/gettext-0.10.35-5-destdir.diff: New files.
	* docs/patches/Makefile.am (EXTRA_DIST): Added them.
	* docs/patches/gettext-0.10.35-2-intllibs.diff,
	docs/patches/gettext-0.10.35-3-memcpy.diff,
	docs/patches/gettext-0.10.35-4-comments.diff: Explained what one
	must do after patching to get the changes propagated to other
	files.
	* intl/ChangeLog, intl/localealias.c, po/Makefile.in.in: Updated
	from gettext-0.10.35.kn.6.

	* po/POTFILES.in: Regenerated.
	* po/fi.po: Synchronised with source.  Using "valitsin" instead of
	"tarkenne".

	* xwad/Makefile.am, tool/Makefile.am, test/Makefile.am,
	ptcomp/Makefile.am, libmissing/Makefile.am,
	libdumbworldb/Makefile.am, libdumbwad/Makefile.am,
	libdumbutil/Makefile.am, libdumbrender/Makefile.am,
	libdumb/Makefile.am, htic/Makefile.am, dumb/Makefile.am,
	doom/Makefile.am, docs/patches/Makefile.am,
	docs/maint/Makefile.am, docs/dos/Makefile.am, docs/Makefile.am,
	aux/Makefile.am, Makefile.am (EXTRA_DIST): Added .cvsignore.

	* docs/maint/Makefile.am (EXTRA_DIST): Removed lsm-template, which
	is now aux/dumb-lsm.in.

	* NEWS: Documented some more changes from ChangeLog.
	* TODO: Libdumbworldb should be rewritten in C++.
	* docs/Install-FAQ: Added Q6: The linker says dcgettext__ is
	undefined.

	* configure.in, acconfig.h (DUMB_CONFIG_DUMBDATADIR): Renamed from
	DUMB_CONFIG_DATADIR and appended "/dumb" to value.
	* dumb/dumb.c (main): Use DUMB_CONFIG_DUMBDATADIR rather than
	DUMB_CONFIG_DATADIR, in builtin_wadpath.

	* dumb/linuxfb_video.c: First version from Josh Parsons.
	* dumb/Makefile.am (EXTRA_DIST): Added linuxfb_video.c.

	* debian/: Removed entire directory.
	* docs/maint/source.html, configure.in, Makefile.am: Removed all
	references to the now removed debian directory.

1998-12-15  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbworldb/dumbworldb.hh: First version
	* libdumbworldb/Makefile.am (libdumbworldb_a_SOURCES): Added
	dumbworldb.hh.

	* acinclude.m4 (DUMB_C_ATTR_REGPARM): Added some quoting.
	(DUMB_CHECK_IFDEF): New macro.
	* configure.in: Moved --enable-libdumbworldb to the beginning.
	(DUMB_CONFIG_GGI): Test whether <ggi/ggi.h> defines GGI_KEY_ENTER.

1998-12-13  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (main): Added "." and DUMB_CONFIG_DATADIR in
	builtin_wadpath.

	* configure.in (DUMB_CONFIG_DATADIR): Define.
	(DUMB_CONFIG_DOOM_DIR): Renamed from DUMB_CONFIG_DOOM_PATH.
	(DUMB_CONFIG_HERETIC_DIR): Renamed from DUMB_CONFIG_HERETIC_PATH.

	* acconfig.h, configure.in (DUMB_CONFIG_DOOM_DIR): Renamed from
	DUMB_CONFIG_DOOM_PATH.
	(DUMB_CONFIG_HERETIC_DIR): Renamed from DUMB_CONFIG_HERETIC_PATH.
	(DUMB_CONFIG_DATADIR): Added.

1998-11-20  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* INSTALL: Incorporated docs/configure.txt.
	* docs/configure.txt: Removed.
	* docs/Makefile.am (EXTRA_DIST): Removed configure.txt.

1998-11-15  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* acconfig.h: Lumped LOCALEDIR, DUMB_CONFIG_DOOM_PATH and
	DUMB_CONFIG_HERETIC_PATH together.

	* configure.in: Made the script print warnings if it decides
	something won't be built.
	* NEWS: Added Local Variables section.  Noted that the configure
	script now warns you if something is missing.

	* Applied sky fix v2 by Andrew Apted.
	* dumb/rendcore.h (draw_sky_segment): Scroll the sky vertically
	and allow different sizes.
	* libdumb/texture.c (load_wtex): Hack around a bug in Heretic wad.
	* NEWS, AUTHORS: Noted "sky fix" by Andrew Apted.

	* libdumb/mme_sound.c: New version from Marcus Sundberg.
	(FRAGSIZE): Replaced by new variable `bytes_per_frag'.
	(NUMBUF): Dropped from 4 to 2.
	(speed): Global variable removed.
	(slush_fragments): Initialised as 0.
	(init_sound): Renamed parameter `s' to `speed'.  Local variable
	`window' removed.
	(play_sound): Moved `int i' inside loop.

	* configure.in: Use "`dirname ${DUMB_CONFIG_DOOM_WAD}`" rather
	than "${DUMB_CONFIG_DOOM_WAD%doom*.wad}".  Similarly for Heretic.
	Patch by Marcus Sundberg.
	* AUTHORS: Credits to Marcus Sundberg for the dirname patch.

	* Applied missile fix by Andrew Apted.
	* dumb/updthing.c (update_things): If the wall is marked with
	LINE_IMPASSIBLE but the protothing doesn't have PT_BEASTIE set,
	let it through.
	* NEWS: Documented Andrew Apted's missile fix.
	* AUTHORS: More credits to Andrew Apted.

	* tool/WADTOOL.PLAN: First version.
	* tool/Makefile.am (EXTRA_DIST): Distribute WADTOOL.PLAN.

	* Applied third-person perspective patch by Andrew Apted.
	* doom/camera.pt: Initial version.
	* doom/Makefile.am (d4d_sources): Added camera.pt.
	* doom/doom.pt: Added #include <camera.pt>.
	* dumb/dumb.c (mainconf): Added --dumb-third-person option.
	(cnf_third_person): New macro.
	(main): Locate, use and move the camera.
	* dumb/things.c (camera_to_view, update_camera): New functions.
	* htic/htic.pt: Added #include "../doom/camera.pt".
	* AUTHORS: Andrew Apted wrote the third-person perspective code.
	* NEWS: Mention --dumb-third-person.

	* configure.in: Look for ppm_readppm() in -lnetpbm if it isn't
	found in -lppm -lpgm -lpbm.  Patch from Markus F.X.J. Oberhumer.
	* tool/Makefile.am (ppm_ldadd): Use @DUMB_PPM_LDADD@.
	* AUTHORS: Added Markus F.X.J. Oberhumer.

1998-11-05  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* debian/rules (package_dumb): chmod documents to 644, not 755!

	* debian/copyright: New file.
	* debian/Makefile.am (EXTRA_DIST): Added copyright.
	* debian/rules (package_dumb): Install more documents.

	* debian/README.Debian: New file.
	* debian/Makefile.am (EXTRA_DIST): Added README.Debian.
	* debian/rules (instdirs): Removed $(tmpdir)/etc.
	(package_dumb): Install documents.

	* aux/rpmspec.m4: Changed comment in spec to match current
	location of this file.

	* debian/rules (binary-arch, binary-indep): Depend on Makefile,
	not build.
	(package_dumb): Pass -ips switch to dpkg-gencontrol.
	* debian/control: Changed priority from extra to optional, as all
	other games seem to have that too.

	* Makefile.am (%/Makefile): New rule.
	* docs/maint/source.html: Documented aux and debian directories,
	and "make foo/Makefile"

	* dumb/dumb.c (main): Made builtin_wadpath doubly const.

	* configure.in (AC_OUTPUT): Added debian/Makefile.
	* Makefile.am (SUBDIRS): Added debian.
	* debian/Makefile.am: New file.
	* debian/.cvsignore: Ignore Makefile and Makefile.in.

	* tool/wadtool.c (print_help): A little #if shuffling.  The
	parameter syntax will probably have to be rethought completely.

	* po/Makefile.in.in (DESTDIR): New variable.  It's empty unless
	overridden in command line.  If specified, it's the root directory
	for installation.  This makes it easier to create Debian packages.

	* debian/: New directory.
	* debian/changelog, debian/rules, debian/control: New files.
	
	* xwad/.cvsignore, tool/.cvsignore, test/.cvsignore,
	ptcomp/.cvsignore, po/.cvsignore, libmissing/.cvsignore,
	libdumbworldb/.cvsignore, libdumbwad/.cvsignore,
	libdumbutil/.cvsignore, libdumbrender/.cvsignore,
	libdumb/.cvsignore, intl/.cvsignore, htic/.cvsignore,
	dumb/.cvsignore, doom/.cvsignore, docs/.cvsignore,
	docs/patches/.cvsignore, docs/maint/.cvsignore,
	docs/dos/.cvsignore, debian/.cvsignore, aux/.cvsignore,
	.cvsignore: Ignore files which are generated during compilation.

1998-10-31  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/Makefile.am (EXTRA_DIST): Added MMX.txt.

	* dumb/renderc.h (Active_wall): Added comment on what MMX
	requires.
	[HAVE_MMX] (mmx_vecadd): Made entire function conditional.
	Changed int * arguments to int[2] arrays.  Made src parameter
	const.
	[HAVE_MMX] (mmx_load, mmx_storelo, mmx_storehi): Don't define
	without HAVE_MMX.

	* AUTHORS: MMX support is by Josh Parsons.

	* dumb/dumb.c (sigill_handler_mmx): Internationalized.  Exit with
	EXIT_FAILURE, not 1.
	(main): Initialize gettext before checking MMX.

	* Applied Josh Parsons' MMX patches 1 to 3.
	* docs/MMX.txt: New file.
	* dumb/bangbang.c (wall_ray_intersection) [HAVE_MMX]: Compute dot
	products with MMX.
	* dumb/dumb.c [HAVE_MMX] (sigill_handler_mmx): New function.
	(main) [HAVE_MMX]: Test that MMX works.
	* dumb/le32_fbrerend.c (fbrerender8, fbrerender16, fbrerender32)
	[HAVE_MMX]: Use MMX.
	* dumb/renderc.h (View_constants) [HAVE_MMX]: Added
	view_sincos_mmx[].
	(render) [HAVE_MMX]: Initialize MM1 & MM5 and clean up.
	(transform_vertices) [HAVE_MMX]: Rotate with MMX.
	(add_objects) [HAVE_MMX]: Rotate with MMX.
	(mmx_vecadd): New function.
	(render_walls) [HAVE_MMX]: Use mmx_vecadd().
	(wall_ray_intersection) [HAVE_MMX]: Use MMX.
	(mmx_load, mmx_storelo, mmx_storehi): New macros.
	(calc_view_constants) [HAVE_MMX]: Initialize
	view_constants.view_sincos_mmx[].  Use MMX to initialize cos_tab[]
	and sin_tab[] in view_constants.
	* libdumb/sound_mix.c (calc_stereo_16) [HAVE_MMX]: Mix with MMX.

1998-10-30  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* tool/wadtool.c (print_help): Rewrote help message to document
	long options.  They don't work yet, so the changes are wrapped in
	#if 0.  The options look rather messy.  It might be good to
	rethink them completely.

	* acinclude.m4 (DUMB_SYS_SHMAT_RMID): Removed extraneous "the"
	from comment.

	* .cvsignore: Ignore aclocal.m4 and config.h.in which are
	generated by aclocal and autoheader.
	* config.h.in, aclocal.m4: Removed from CVS.

	* .cvsignore, docs/.cvsignore, docs/dos/.cvsignore,
	docs/maint/.cvsignore, docs/patches/.cvsignore, doom/.cvsignore,
	dumb/.cvsignore, htic/.cvsignore, libdumb/.cvsignore,
	libdumbrender/.cvsignore, libdumbutil/.cvsignore,
	libdumbwad/.cvsignore, libdumbworldb/.cvsignore,
	libmissing/.cvsignore, po/.cvsignore, ptcomp/.cvsignore,
	test/.cvsignore, tool/.cvsignore, xwad/.cvsignore: New files.
	* configure, Makefile.in, stamp-h.in, docs/Makefile.in,
	docs/dos/Makefile.in, docs/maint/Makefile.in,
	docs/patches/Makefile.in, doom/Makefile.in, dumb-0.13.3-1.spec,
	dumb/Makefile.in, htic/Makefile.in, libdumb/Makefile.in,
	libdumbrender/Makefile.in, libdumbutil/Makefile.in,
	libdumbwad/Makefile.in, libdumbworldb/Makefile.in,
	libmissing/Makefile.in, po/cat-id-tbl.c, po/dumb.pot, po/fi.gmo,
	po/stamp-cat-id, ptcomp/Makefile.in, test/Makefile.in,
	tool/Makefile.in, xwad/Makefile.in: Removed these files from CVS
	because they are now listed in .cvsignore.

	* aux/: New directory.
	* aux/rpmspec.m4, aux/mkinstalldirs, aux/missing, aux/install-sh:
	Moved from parent directory.
	* aux/dumb-lsm.in: Renamed from docs/maint/lsm-template.
	* aux/Makefile.am: New file.
	* configure.in: Added AC_CONFIG_AUX_DIR(aux).
	(AC_OUTPUT): Added aux/Makefile.
	* Makefile.am: Lowercased all internal variables.  Take rpmspec.m4
	and dumb-lsm.in from aux/.
	(SUBDIRS): Added aux.

	* ChangeLog: It's --enable-libdumbworldb, not --enable-worldbase.
	* docs/configure.txt: Documented --enable-libdumbworldb.
	* README: We support the Degas version of GGI, not Dali any more.
	* docs/maint/contrib.html: Changes should be sent to dumb-list.

	* configure.in: Updated version number to 0.13.4.
	* NEWS: Added a section for DUMB 0.13.4.
	* README, docs/maint/source.html, docs/configure.txt: Updated DUMB
	version numbers.

1998-10-21  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.13.3.

	* ptcomp/ptcomp.c (main): Added cast to make C++ happy.

	* README (Bugs in other software): Gettext bugs are no longer
	being investigated.

	* ptcomp/ptcomp.c (show_help): --output-directory is -d, not -o.
	(main): Changed the deprecated-usage message too.

	* tool/dark2trans.c, tool/mkdfnt.c, test/fixed_bm.c: #include
	<errno.h>.

	* docs/patches/Makefile.am: New file.
	* configure.in (AC_OUTPUT): Added docs/patches/Makefile.

	* docs/maint/indent.pro: Added -TXImage.

	* Makefile.am, configure.in: Compile libdumbworldb only if
	--enable-libdumbworldb is given.
	* acconfig.h: Added DUMB_CONFIG_LDWB.
	* test/Makefile.am: Compile ldltest only if --enable-libdumbworldb
	was given.

	* ptcomp/ptcomp.c (main): --output-directory is -d, not -o.
	* doom/Makefile.am ($(d4d_pt_lumps)): Use -d.
	* htic/Makefile.am ($(h4d_pt_lumps)): Use -d.

1998-10-20  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* TODO: --help and --version are now supported!  Hooray!

	* tool/mknulmap.c, tool/mkdfnt.c: Use getopt_long().

1998-10-18  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* tool/dark2trans.c: Use getopt_long().

	* docs/maint/contrib.html: Converted to HTML 4.0 and reformatted
	with PSGML.

	* docs/maint/source.html: Converted to HTML 4.0 Transitional and
	reformatted with PSGML.

1998-10-17  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* htic/Makefile.am ($(h4d_pt_lumps)): Added -o in ptcomp
	invocation.
	* doom/Makefile.am ($(d4d_pt_lumps)): Here too.

	* ptcomp/ptcomp.c (main): Use getopt_long().

	* xwad/xproto.c (silent): Renamed to sound_flag and inverted
	sense.
	(usage): Renamed to print_help() and mostly rewritten.
	(print_version): New function.
	(main): Use getopt_long().

	* test/ldltest.c: #include "getopt.h", not <getopt.h>.

	* libdumbutil/exitcode.h: New file.

	* libdumbutil/bugaddr.c (program_bug_address): Replaced my address
	with dumb-list.

	* tool/Makefile.am (LDADD): Added ../libmissing/libmissing.a.
	(INCLUDES): Added -I$(top_srcdir)/libmissing.
	* xwad/Makefile.am (LDADD, INCLUDES): Here too.
	* ptcomp/Makefile.am (LDADD, INCLUDES): Here too.
	* dumb/Makefile.am (LDADD, INCLUDES): Here too.
	* test/Makefile.am (LDADD): Added this variable.
	(fixed_bm_LDADD, ldltest_LDADD): Use it.

1998-10-16  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* tool/ppmtodumb.c (mkcmap): Removed parameter.  Use the global
	variable directly.

	* xwad/xwad.c (main): Use getopt_long().

	* tool/wadtool.c (print_help, print_version): New functions.
	(main): Check --help and --version.

	* libdumbutil/bugaddr.c, libdumbutil/bugaddr.h: New files.
	* libdumbutil/confhelp.c (conf_usage): Use them.
	* ptcomp/ptcomp.c (show_help): Use them.
	* test/fixed_bm.c (main): Use them.
	* test/ldltest.c (print_help): Use them.
	* tool/dark2trans.c (print_help): Use them.
	* tool/mkdfnt.c (print_help): Use them.
	* tool/mknulmap.c (print_help): Use them.
	* tool/mkpnames.c (print_help): Use them.
	* tool/ppmtodumb.c (print_help): Use them.

	* tool/ppmtodumb.c: Rewrote argument parsing.
	* tool/mkpnames.c: Rewrote argument parsing.  Check all file
	operations.

	* libdumbutil/copyright.h (struct copyright): Renamed owner to
	holder.

1998-10-09  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* tool/mknulmap.c (print_help, print_version): New functions.
	(main): Use them.

	* configure.in: Check for ggiParseMode() rather than ggiSetMode()
	because older GGI versions had only the latter.

	* tool/mkdfnt.c: Made all exit codes #defines.
	(print_help, print_version): New functions.
	(main): Use them.

	* tool/dark2trans.c (print_help, print_version): New functions.
	(main): Use them.

	* test/ldltest.c (print_help, print_version): New functions.
	(main): Use them.

	* dumb/dumb.c (print_program_version): Use the new copyright
	functions.

	* ptcomp/ptcomp.c (main): Support --help and --version.
	(show_help, show_version): New functions.

	* libdumbutil/copyright.c, libdumbutil/copyright.h: New files.

	* ptcomp/ptcomp.c (main): Remove arbitrary limit on directory name
	length.

1998-09-30  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/video.h, dumb/aalib_video.c, dumb/dos_video.c,
	dumb/dummy_video.c, dumb/ggi_video.c, dumb/linux_video.c,
	dumb/x11_video.c: Added video_dep_name.
	* dumb/dumb.c (print_program_version): Use video_dep_name.  Added
	fancy copyright list.

1998-09-28  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/confhelp.c (conf_usage): Recommend --help rather
	than -?.
	(conf_help, conf_usage): Change return type from void because they
	always returned 1.
	* libdumbutil/confargs.c (conf_args): Treat "--help" just like
	"-?".  Parse "--version".  Return void.  Call exit() directly.
	* dumb/dumb.c (main): Don't check conf_args() return value.

1998-09-27  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in (Local Variables): Added info-lookup-mode.

1998-08-30  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.13.2.

	* Makefile.am ($(distdir).lsm): New target.
	(RPMSPEC): Use $(srcdir).
	(EXTRA_DIST): Use $(RPMSTEM).spec instead of $(RPMSPEC).
	(kn-dist): New target.

1998-08-29  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/maint/: New directory.  Moved various files there.
	* configure.in: Added docs/dos and docs/maint directories.

	* docs/discord.txt: New file.
	* docs/Makefile.am (EXTRA_DIST): Added discord.txt.

1998-08-24  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (main): Always log to stdout until the configuration
	has been parsed.
	* libdumbutil/log.c (log_cleanup): Renamed to log_close_all() and
	published.  All callers changed.

	* dumb/gettable.c (rotate_selection): Don't call set_bogot() if
	nothing gets selected.

	* dumb/x11_video.c (keymap_keycode_to_keyname): Added
	GGI-compatible names for pad keys.
	* dumb/keymap.c (keymap_defaults): Changed X11 pad keys from "XK_"
	to "Pad ".

1998-08-23  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dos/: New directory.
	* docs/dos.txt: Superseded by docs/dos/dos-compile.txt.
	* docs/Makefile.am (EXTRA_DIST): Updated.

Mon Aug 17 16:35:05 1998  Josh Parsons  <josh@coombs.anu.edu.au>

	* dumb/bangbang.c (thing_can_shoot_at): reworked 2S wall
	checking: previously monsters could see right through low
	ceilings and high walls.
	* dumb/levdyn.c (diffchk): workaround for a bug in Doom
	and Heretic .wads, some player start locations have no 
	difficulty level eg. htic E2M8 
	* xwad/choose.c (sb_motion, sb_button): fixed a bug that
	prevented scroll bars from scrolling upwards
	* doom/monsters.pt, htic/monsters.pt: ImmuneToSuch
	sprinkled in appropriate places, more tweaks, esp. to
	lost souls, Heretic's Maulotaur
	* dumb/netplay.h, dumb/netplay.c, dumb/dumb.c: new level
	transitions in network play
	* dumb/thingm.c: fixed a bug causing monsters to always
	shoot, never fight, tweaked turnspeeds somemore, explosives
	w/o hitpoints can never be set off by another explosion
	* dumb/netplay.c (send_one_slaveinit), 
	dumb/levinfo.c (load): fixed bugs that prevented multiplayer 
	games with 3 or more players
	* libdumb/prothingstruct.h: TPH_TINVIS, TPH_WHIRLY, PT_MINE,
	PT_STUCKDOWN, PT_IMMUNETOSUCH, TPH_CHARGE, TPH_RSKIP defined
	* ptcomp/protocomp.c, ptcomp/phasecomp.c: many new keywords
	to match new PT_ and TPH_ flags
	* ptcomp/soundcomp.c (new_sound): make sure that new SoundRec
	is inited to all zeros with memset

1998-08-15  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (main): conf_file is a pointer, not an array.
	* libdumbutil/conffile.c (conf_file_name): Replaces
	find_conf_file().

	* libdumbutil/conffile.c (parse_conf_strings, dequote_conf_string,
	fput_conf_string): New functions to handle quoting.  All strings
	and lists are now quoted and backslashified when saved.
	* TODO (conf): Quoting now done.
	* libdumbutil/strgrow.c, libdumbutil/strgrow.h: New files.

Thu Aug 13 00:19:27 1998  Josh Parsons  <josh@coombs.anu.edu.au>

	* dumb/updthing.c: fixed bug introduced in previous patch,
	causing heretic missiles to be affected by gravity. tweaked
	gravity/floatup acceleration to be more processor-speed 
	independent
	* htic/missiles.pt, htic/monsters.pt: implemented WereDragon,
	Pod

1998-08-08  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/ggi_video.c: Revision 1.6 from Andrew Apted.

	* test/fixed_bm.c: Added copyright notice.
	(rtimer): Don't use SIGVTALRM at all.

	* dumb/unix_net.c (udp_init_station): Moved rs->addr assignment
	inside typecast.

	* dumb/Makefile.am (ggidumb_SOURCES): Included $(keyname_sources).
	* configure.in: Updated GGI check.

Fri Aug  7 16:31:35 1998  Josh Parsons  <josh@coombs.anu.edu.au>

	* libdumb/prothingstruct.h: PT_TAKESECTDMG defined
	* doom/missiles.pt, doom/monsters.pt, htic/missiles.pt,
	htic/monsters.pt: speed and damage tweaks
	* dumb/levdyn.h (ThingDyn): added last_hit_wall field, so
	monsters know when they last crashed into a wall
	* dumb/updthing.c (update_things): maintain last_hit_wall,
	flying monsters fall when they run out of hits, only
	players get hurt by the Patented Doom Fluid
	* dumb/thingm.c (do_strategy): monsters try to dodge out
	of enemy's line of fire, miscellaneous fine tuning

Wed Jul 22 03:06:11 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.13.1.

	* libmissing/Makefile.am (INCLUDES): Added.

Sat Jul 11 21:43:27 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c, xwad/xwad.c, xwad/xproto.c, ptcomp/ptcomp.c,
 	tool/wadtool.c, tool/mknulmap.c, tool/mkpnames.c,
 	tool/dark2trans.c, tool/ppmtodumb.c, tool/mkdfnt.c,
 	test/ldltest.c: Include <locale.h>.
	Reported by Josh Parsons.

	* dumb/dumb.c (main): Use DUMB_CONFIG_DOOM_PATH and
	DUMB_CONFIG_HERETIC_PATH only if they are defined.
  	Patch from Josh Parsons.
	* configure.in: Don't define DUMB_CONFIG_DOOM_PATH and
	DUMB_CONFIG_HERETIC_PATH if the files weren't found.

	* libdumb/linux_sound.c (play_sound): Return right away if fd<0.
	* libdumb/sound_mix.c (sndmix_play_sound, sndmix_calc_frag):
 	assert(sndmix_inited).

Fri Jul  3 19:51:30 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/Install-FAQ: Added Q3: Ppmtodumb dumps core.

	* AUTHORS: Changed Ulf Axelsson's WWW address again.

	* htic/Makefile.am (pt_preprocess): Add "-I$(top_srcdir)".
  	Reported by Josh Parsons.
	* dumb/keymap.c (keymap_defaults): Capitalize "Space".  Patch by
 	Josh Parsons.

Wed Jul  1 20:41:38 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* AUTHORS: Changed Ulf Axelsson's addresses.

	* docs/params.txt: New file.
	* docs/dos.txt: New file.
	* docs/Makefile.am (EXTRA_DIST): Add them.

Tue Jun 30 20:59:19 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/Makefile.am (EXTRA_DIST): Use $(VERSION).
	* docs/dumb-0.13.1.lsm: Updated and renamed.

	* Makefile.am (RPMSPEC, RPMIN): Don't use $(srcdir) yet.
	($(RPMSPEC)): Use automatic variables in the rule.

Mon Jun 29 20:13:03 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/x11_video.c (video_conf): Add --vid-abort-on-error.
	(init_video): Support it.
	(error_abort): New function.
	(untrapped_errh): New variable.
	(trap_errs, untrap_errs): Use untrapped_errh.
	(errh, error_abort): Make extern "C".
	(BEGIN_EXTERN_C, END_EXTERN_C): New macros.

	* docs/indent.pro: Add -TXErrorEvent.

	* dumb/x11_video.c (init_video): Treat BPP=4 as 24-bit.  Patch by
 	Josh Parsons.

	* docs/configure.txt: Doc fix.

	* dumb/x11_video.c (video_conf): Add --vid-sync-io.
	(init_video): Support it.

Sun Jun 28 16:48:14 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/safeio.c (safe_mmap): Add casts for C++ compatibility.
	* libdumbutil/safem.c (safe_strdup): Add casts.
	* libdumbwad/loadlump.c (llinit): Add casts.
	* libdumbwad/wadio.c (add_hashent): Add casts.
	(check_sanity): Signedness fix.
	(load_wad): Add casts.
	(lumpnext): Signedness fix.
	(lumplook): Signedness fix.
	* libdumbwad/wadwr.h (WADWR): Signedness fix.
	* libdumbworldb/loaddoom.c (load_doom_sectors): Add casts.
	(load_doom_vertexes): Add casts.
	(load_doom_linedefs): Add casts.
	(load_doom_things): Add casts.
	* libdumbworldb/observer.c (dwdb_new_observer): Add casts.
	* libdumbworldb/savedoom.c (save_doom_vertexes): Add casts.
	(save_doom_sectors): Add casts.
	(save_doom_sidedefs): Add casts.
	(save_doom_linedefs): Add casts.
	* libdumbworldb/thingsec.c (_dwdb_new_thingsec): Add casts.
	* libdumb/prothing.c (get_sprite_table): Add casts.
	(init_prothings): Add casts.
	* libdumb/texture.c (init_playpal): Add casts.
	(init_pnames): Add casts.
	(reset_texture_lumps): Add casts.
	(guess_sprite_size): Add casts.
	(load_sprite): Add casts.
	(load_flat): Add casts.
	(init_patches): Add casts.
	(get_patch_data): Add casts.
	* dumb/dumb.c (main): Add a const to wadpath.
	* dumb/gettable.c (draw_count): Signedness fix.
	* dumb/levinfo.c (init_levinfo): Add casts.
	* dumb/netplay.c (netplay_poll): Signedness fix.
	* dumb/keymap.c (keymap_set_capacity): Add casts.
	* dumb/keymapconf.c (check_binding): Add casts.
	* dumb/renderc.h (init_renderer): Add casts.
	* dumb/unix_net.c (udp_init_station): Add casts.
	(udp_recpkt): Add casts.
	* dumb/linux_video.c (init_video): Add casts.
	(page, pagev): Make unsigned.
	* dumb/x11_video.c (explicit): Define as xkb_explicit.
	* dumb/unix_net.c (udp_sendpkt): Add cast.
	* xwad/xwad.c (init_instance): Add casts.
	* xwad/disphash.c (add_dh): Add casts.
	* xwad/mapcon.c: #include <stdlib.h>
	* xwad/savemap.c (gc_vers): Add cast.
	(gc_sides): Add cast.
	(gc_sects): Add cast.
	* xwad/xproto.c (init_instance): Add cast.
	* test/ldltest.c (queue_op): Add cast.

	* docs/indent.pro: Add -Tcaddr_t.

	* configure.in: Integrate dosdumb-0.13.0 from Ulf Axelsson.
	* dumb/Makefile.am, libdumb/dos_sound.c, libdumbutil/Makefile.am:
 	Ditto.

	* configure.in (--disable-c): New option.

Fri Jun 19 14:17:39 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile.am (RPMIN): Use $(srcdir).

	* libdumbutil/confdef.h (CONFNB): Rename to CONFB_1.  All callers
 	changed.
	(CONFNS): Rename to CONFB_NS.  All callers changed.
	(CONFS): Remove maximum length parameter.  All callers changed to
 	either leave maxlen out or use CONFS_L instead.
  	(CONFS_L): This is what CONFS used to be.

	* AUTHORS (Andrew Tridgell): Added email address.
	(Ulf Axelsson): Added URL.

	* configure.in (CXX_HACK_CC): Define as $CC if little-endian.
	* libdumbutil/Makefile.am (INCLUDES): Add -I../intl.
	(CC): Define as $(CXX_HACK_CC).
	* libdumbwad/Makefile.am: Here too.
	* libdumbrender/Makefile.am: Here too.
	* dumb/Makefile.am: Here too.
	* xwad/Makefile.am: Here too.
	* ptcomp/Makefile.am: Here too.
	* tool/Makefile.am: Here too.
	* test/Makefile.am (INCLUDES): Already had -I../intl.
	(CC): Define as $(CXX_HACK_CC).

	* rpmspec.m4: Don't undivert -1 to -1.  Removed empty lines from
 	beginning of output.

Thu Jun 18 01:12:57 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile.am ($(RPMSPEC)): Use $(srcdir).
	(MAINTAINERCLEANFILES): Added.

Wed Jun 17 19:16:43 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libmissing/Makefile.am: Don't assign CC.

	* Makefile.am (.PHONY): update-po was update-POTFILES.in.

	* configure.in: Save C-as-C++ command as $CXX_HACK_CC and not
 	directly in $CC.

Sun Jun 14 19:43:20 1998  Josh Parsons <josh@coombs.anu.edu.au>

	* libdumbworldb/dummyvtbl.c: Commented out GCC trickery, 
	as it breaks C++ compilation on bigendian architecture
	* libmissing/Makefile.am: use C even on bigendian arch.

	* Makefile.am: target to build a rpm-style .spec file
	* rpmspec.m4: template for .spec file

	* dumb/dumb.c: use built-in wadpath if none specified

	* configure.in: figure out appropriate built-in wadpath, 
	stash real C compiler name in REALCC for libmissing

	* test/fixed_bm.c: include locale.h

Thu Jun 11 19:17:33 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.13.0.

	* libdumbutil/align.h: New file.
	* libdumbwad/wadwr.c: Renamed ALIGNMENT to ALIGN_LUMP and moved it
 	to libdumbutil/align.h.
	* tool/mkpnames.c (main): Align TEXTURE1 entries.

Wed Jun 10 20:24:11 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile.am (update-po): Don't ignore libintl.h explicitly.

	* libdumb/linux_sound.c: Use sound_mix.
	* libdumb/mme_sound.c: Use sound_mix.

	* libdumb/sound_mix.h: New file.
	* libdumb/sound_mix.c: New file.

Mon Jun  8 21:47:18 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumb/dsound.c: Reindent.
	(play_dsound_local): Update s and ent on redirection.

Sun Jun  7 11:13:34 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumb/linux_sound.c (resample_and_sum, poll_sound): Handle
 	AFMT_U8 by filling the fragment with 0x80 and adding signed values
 	to that.

	* acconfig.h (DUMB_CONFIG_SOUND_STEREO, DUMB_CONFIG_SOUND_16BIT):
 	Delete.
	* libdumb/linux_sound.c: Choose bits & channels at runtime.
	* configure.in (dumb_sound_options): Delete.

	* docs/indent.pro: New file.
	* libdumb/linux_sound.c: Reindent with that.

Sat Jun  6 16:37:00 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/confdef.h (CONFENUM_END): New macro.
	* dumb/linux_input.c (mousies): Use CONFENUM_END.
	* dumb/x11_video.c (grab_choices): Use CONFENUM_END.
	* dumb/aalib_video.c (dither_choices): Use CONFENUM_END.

	* libdumbutil/confdef.h (CONFITEM_END): New macro.
	* dumb/aalib_video.c (video_conf): Use CONFITEM_END.
	* dumb/dummy_video.c (video_conf): Use CONFITEM_END.
	* dumb/linux_input.c (input_conf): Use CONFITEM_END.
	* dumb/x11_video.c (video_conf, input_conf): Use CONFITEM_END.
	* dumb/game.c (playconf): Use CONFITEM_END.
	* dumb/dummy_input.c (input_conf): Use CONFITEM_END.
	* dumb/unix_net.c (net_conf): Use CONFITEM_END.
	* dumb/dummy_net.c (net_conf): Use CONFITEM_END.
	* dumb/keymapconf.c (keymapconf): Use CONFITEM_END.
	* dumb/aalib_input.c (input_conf): Use CONFITEM_END.
	* dumb/ggi_video.c (input_conf, video_conf): Use CONFITEM_END.
	* dumb/linux_video.c (video_conf): Use CONFITEM_END.
	* dumb/netplay.c (netplay_conf): Use CONFITEM_END.
	* dumb/dumb.c (mainconf): Use CONFITEM_END.

	* libdumb/sound.h (sound_conf): New.

	* dumb/updmap.c: Use LOG_WARNING.
	* dumb/levinfo.c: Use LOG_WARNING.
	* libdumb/linux_sound.c (init_sound): Use safe_open().
	Internationalize.  Use strerror(errno).
	* libdumbworldb/savedoom.c (dwdb_save_doom): Internationalize.
	* libdumbworldb/del.c (dwdb_del_sector): Use LOG_WARNING.
	* libdumbutil/log.c (struct _LogFile): Rename to struct LogFile.
  	Change type of lvl to enum log_level.  Make cl a pointer and
 	rename it to classes.
	(log_cleanup): Free logs and logs->classes.
	(log_stream): Allocate log->classes dynamically.  Use
 	safe_malloc() and safe_strdup().
	(log_file): Use safe_malloc() and strerror(errno).
	(LogFile): Replace FILE *falloc with unsigned flags and
 	LOGF_CLOSE.
	(add_logfile): New function.
	(log_stream, log_file): Rewrite with add_logfile().
	(do_logfatal): Change perror() text.
	(logfatal, do_logfatal): Exit with EXIT_FAILURE, not 1.
	* libdumbutil/log.h (LOG_FATAL, LOG_BANNER, LOG_ERROR, LOG_INFO,
 	LOG_XINFO, LOG_DEBUG, LOG_ALL): Move to enum log_level.
	(LOG_WARNING): New.

	* libdumb/prothing.c (find_phase_sprite): Return NULL without
 	complaining if neither the proto nor the phase specifies a sprite.

Tue Jun  2 18:09:55 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-0.13.0.lsm (Copying-policy): Doc fix.

Sun May 31 15:35:17 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/dumb-autoins.el: New file.

	* libdumbutil/dumb-nls.h: New file.

	* configure.in: Bump version to 0.13.0.

	* xwad/controls.h (CTLACTION, CTLPRED, CTLINPUT, CTLOUTPUT): Make
 	functions generated with these static.
	* xwad/xproctls.c, xwad/tchoose.c, xwad/xwadctls.c: Remove static
 	keywords from CTL* definitions.

Sun May 24 19:05:35 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* tool/wadtool.c (verbose_flag): New.
	(catwad, main): Conditionalize "Copying..." messages on
 	verbose_flag and make them more informative.

	* libdumbutil/safem.c (safe_vcalloc): Move filenames to the
 	beginning of error messages.
	(safe_realloc, safe_malloc, safe_calloc): Don't use errno.
	(safe_malloc, safe_calloc): No error if malloc(0)==NULL.
	(safe_strdup): Use safe_malloc() and strcpy() instead of strdup().
	(safe_realloc): Handle size==0 separately.

	* test/ldltest.c: Use libdumbworldb instead of libdumblevel.

Wed May 20 17:04:25 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in: Update version number to 0.12.3.

Tue May 12 17:03:27 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.12.2-snapshot.

Mon May 11 13:30:46 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumblevel/: Rename to libdumbworldb/.  Rename functions and
	structures accordingly.

	* libdumblevel/dummyvtbl.c: New file.

Sat May  9 10:31:48 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile.am (update-POTFILES.in): Rename to update-po and run
 	make update-po in po/.

	* docs/Install-FAQ: Doc fix.

	* test/Makefile.am (ldltest_LDADD): Add ../libmissing/libmissing.a.
	* libmissing/: New directory.

Fri May  8 13:02:58 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile.am (update-POTFILES.in): New target.
	* docs/source.html: Doc fix.

	* libdumblevel/difficulty.c: New file.

	* libdumblevel/isok.c (dumblevel_isok_thing): New function.

	* test/ldltest.c (enum operation): Add OP_SECTOR_THINGS and
 	OP_THING_SECTORS.
	(parse_args): Support --sector-things and --thing-sectors.
	(parse_long, parse_int): New functions.
	(perform_op): Support OP_SECTOR_THINGS and OP_THING_SECTORS.
	(list_sector_things, list_thing_sectors): New functions.

	* libdumbutil/fixed.h: Include <limits.h>.

	* libdumblevel/findsec.c: New file.
	* libdumblevel/thingsec.c: New file.

	* libdumblevel/initfini.c (dumblevel_init, dumblevel_fini): Thing
 	support.

Thu May  7 18:50:44 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumblevel/dumblevel.h (struct dumblevel_sector): Add things
 	pointer.
	(struct dumblevel_thing): Add sectors pointer.
	* libdumblevel/private.h (struct _dumblevel_thingsec): New.
	* libdumbutil/Makefile.am (libdumbutil_a_SOURCES): Move intset.*
	to EXTRA_libdumbutil_a_SOURCES.

Wed May  6 18:10:43 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/Makefile.am (libdumbutil_a_SOURCES): Sort.  Add
 	intset.c and intset.h.
	* libdumbutil/intset.h: New file.
	* libdumbutil/intset.c: New file.

Tue May  5 11:23:06 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* xwad/xwadctls.c: Internationalize.
	* xwad/xwad.c: Internationalize.
	* xwad/xproto.c: Internationalize.
	* xwad/xproctls.c: Internationalize.
	* xwad/tchoose.c: Internationalize.
	* xwad/mapcon.c: Internationalize.
	* xwad/connect.c: Internationalize.
	* tool/wadtool.c: Internationalize.
	* tool/ppmtodumb.c: Internationalize.
	* tool/mkpnames.c: Internationalize.
	(main): Open fin with "r", not "rt".
	* tool/mknulmap.c: Internationalize.
	* tool/mkdfnt.c: Internationalize.
	* tool/dark2trans.c: Internationalize.

Mon May  4 00:33:47 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/Makefile.am (LDADD): Add $(INTLLIBS).

	* libdumbwad/wadio.c (load_wad): Print wh with "%p".

	* ptcomp/token.c: Internationalize.
	* ptcomp/soundcomp.c: Internationalize.
	* ptcomp/ptcomp.c: Internationalize.
	* ptcomp/protocomp.c: Internationalize.
	* ptcomp/phasecomp.c: Internationalize.
	* ptcomp/parm.c: Internationalize.
	* ptcomp/ltcomp.c: Internationalize.
	* ptcomp/licomp.c: Internationalize.
	* ptcomp/gettcomp.c: Internationalize.
	* ptcomp/animcomp.c: Internationalize.
	* libdumbwad/wadwr.c: Internationalize.
	* libdumbwad/wadio.c: Internationalize.
	* libdumbutil/safeio.c: Internationalize.

	* libdumbutil/safeio.c (safe_mmap) [!HAVE_MMAP]: Cast size_t to
 	unsigned long before printing.

	* libdumbutil/log.c: Internationalize.
	* libdumbutil/confhelp.c: Internationalize.
	* libdumbutil/conffile.c: Internationalize.
	* libdumbutil/confeng.c: Internationalize.
	* libdumb/texture.c: Internationalize.
	* libdumb/prothing.c: Internationalize.
	* libdumb/mme_sound.c: Internationalize.
	* libdumb/dsound.c: Internationalize.
	* libdumb/dos_sound.c: Internationalize.

Sun May  3 16:28:10 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (main) [ENABLE_NLS]: Initialize NLS.

	* dumb/renderc.h [i386 && !DEBUG]: Include rendsl86.h instead of
 	rendsl.h.

	* dumb/aalib_input.c: Internationalize.
	* dumb/aalib_video.c: Internationalize.
	* dumb/animtex.c: Internationalize.
	* dumb/bangbang.c: Internationalize.
	* dumb/banner.c: Internationalize.
	* dumb/ctlkey.c: Internationalize.
	* dumb/dos_input.c: Internationalize.
	* dumb/dos_video.c: Internationalize.
	* dumb/dumb.c: Internationalize.
	* dumb/dummy_input.c: Internationalize.
	* dumb/game.c: Internationalize.
	* dumb/gettable.c: Internationalize.
	* dumb/ggi_video.c: Internationalize.
	* dumb/keymap.c: Internationalize.
	* dumb/keymapconf.c: Internationalize.
	* dumb/levdata.c: Internationalize.
	* dumb/levdyn.c: Internationalize.
	* dumb/levinfo.c: Internationalize.
	* dumb/linetype.c: Internationalize.
	* dumb/linux_input.c: Internationalize.
	* dumb/linux_video.c: Internationalize.
	* dumb/netio.c: Internationalize.
	* dumb/netplay.c: Internationalize.
	* dumb/rendcore.h: Internationalize.
	* dumb/renderc.h: Internationalize.
	* dumb/termtype.c: Internationalize.
	* dumb/thinghit.c: Internationalize.
	* dumb/thingm.c: Internationalize.
	* dumb/unix_net.c: Internationalize.
	* dumb/updmap.c: Internationalize.
	* dumb/updthing.c: Internationalize.
	* dumb/vgagl_video.c: Internationalize.
	* dumb/x11_video.c: Internationalize.

	* docs/template.c: New file.

	* AUTHORS: Remove lists of what each person has done.

	* libdumb/texture.c (load_wtex): Don't care about NO_1P_KLUDGE.
  	Instead check pointer alignment.  Patch from Marcus Sundberg.
	* dumb/netio.c (net_bufsend): Cast len to unsigned long for
	printing.  Noticed by Marcus Sundberg.
	* dumb/netplay.c (netplay_poll): Likewise with pktlen and
 	sizeof(slave_info).  Subtract 2 from the sizeof in error message.
	* dumb/x11_video.c [!DUMB_CONFIG_XF86DGA]: Don't define page2ofs,
 	page2line, curpage.
	(video_newframe) [!DUMB_CONFIG_XF86DGA]: Don't check curpage.

Sat May  2 12:50:55 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumblevel/loaddoom.c (dumblevel_init_doom): Call
 	load_doom_things().
	(load_doom_things): New function.
	(load_doom_sectors, load_doom_vertexes, load_doom_linedefs): Use
 	LOG_ERROR instead of LOG_FATAL and return early if
 	safe_lookup_lump() fails.
	* libdumblevel/dumblevel.h (struct dumblevel_thing): New.

	* xwad/controls.h (CTLATTR): Always define as ATTR_REGPARM.
	* libdumbutil/fixed.h (FIX_ATTR): Use ATTR_REGPARM regardless of
 	defined(i386).
	* libdumbutil/Makefile.am (fixed_CFLAGS, fixed.o): Remove.
	* acconfig.h: Define ATTR_REGPARM as empty.
	* configure.in: Use DUMB_C_ATTR_REGPARM.
	* acinclude.m4 (DUMB_C_ATTR_REGPARM): New macro.

	* README: Doc fix.

	* libdumb/dos_sound.c: New file.  From Ulf Axelsson
 	<ulf@ore.ims.se>.  Tweak #includes for DUMB 0.12.
	* dumb/dos_video.c: Likewise.
	* libdumbutil/dos_timer.c: Likewise.  Remove CR characters.
	* dumb/dos_input.c: Likewise.
	(init_input) Use LOG_ERROR instead of LOG_FATAL if mouse is not
 	found.
	* dumb/dosinput.c: Remove.
	* dumb/dosvideo.c: Remove.

Fri May  1 23:21:23 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/updmap.c (do_sector_event): Change sector type to 0 on
 	ME_CEILING_TEX and ME_FLOOR_TEX.  Patch from Andrew Apted
 	<ajapted@netspace.net.au>.
	* doom/linetypes.pt (LineType 22): Use FloorTexture, not
 	FloorType.

Thu Apr 30 21:20:55 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* test/fixed_bm.c: Mark translatable strings.  Change
 	conversionless printf() calls to fputs() and putchar().
	(main) [ENABLE_NLS]: Call setlocale(), bindtextdomain() and
 	textdomain().

Wed Apr 29 10:01:15 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* acconfig.h (ENABLE_NLS, HAVE_CATGETS, HAVE_GETTEXT,
 	HAVE_LC_MESSAGES, HAVE_STPCPY, LOCALEDIR): New.
	* acinclude.m4 (AM_GNU_GETTEXT): New macro.
	* test/Makefile.am (LIBS): Define as @INTLLIBS@ @LIBS@.
	* Makefile.am (SUBDIRS): Add intl and po.
	* configure.in: Add internationalization section.
	(AC_OUTPUT): Add intl/Makefile and po/Makefile.in.
	(AC_INIT): Change filename to something newer.

	* po/: New directory.
	* intl/: New directory.
	* ABOUT-NLS: New file.

	* libdumbwad/wadwr.c: Use stdio.
	(ALIGNMENT): New constant.
	(aligned_pos): New function.  Replaces macro tell().
	(wadwr_open): Strdup w->fname and free it on errors.
	(wadwr_close): Free w->fname.

	* libdumbwad/wadio.c (load_wad): Print only 4 first characters
	from the signature.

	* libdumblevel/loaddoom.c (load_doom_vertexes, load_doom_sectors):
 	Use assert().

	* test/Makefile.am (LDADD): Separate to fixed_bm_LDADD and
	ldltest_LDADD.
	* dumb/Makefile.am (LDADD, dependencies): Take libdumblevel.a out.

	* libdumblevel/savedoom.c (save_doom_vertexes, save_doom_sectors):
 	Implement.
	(store_texname, save_doom_sidedefs, save_doom_linedefs, struct
 	savedoom_ctx): New.

Tue Apr 28 18:49:01 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* README: Doc fix.

	* test/ldltest.c (enum operation, perform_op): Add OP_SET_NAME and
 	OP_SET_LONGNAME.
	(struct op_node): Use an union.
	(parse_args): Support --set-name=NAME and --set-long-name=NAME.
	(list_sector_sides): Use dumblevel_isok_sector().
	(difficulty): Initialize to -1.

	* libdumblevel/dumblevel.h (struct dumblevel): Add longname.
	* libdumblevel/prop.c (dumblevel_set_longname): New function.
	* libdumblevel/initfini.c (dumblevel_init, dumblevel_fini): Handle
 	lev->longname.

	* libdumblevel/loaddoom.c (dumblevel_init_doom): Remove DIFFICULTY
	and MULTIPLAYER parameters.

	* libdumblevel/isok.c: New file.

	* libdumblevel/prop.c (dumblevel_set_longname): New function.

	* libdumblevel/savedoom.c: Implement basics.

	* libdumblevel/lineprop.c (dumblevel_set_line_side): Notify observers.
	* libdumblevel/detach.c (_dumblevel_detach_side): Notify
 	observers.
	* libdumblevel/dumblevel.h (enum dumblevel_object_type): Add
 	DUMBLEVEL_OT_LEVEL.

Sun Apr 26 11:07:14 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumbutil/safem.c (safe_realloc): Handle p1==NULL separately.

	* libdumblevel/del.c (dumblevel_del_vertex, dumblevel_del_sector,
 	dumblevel_del_side, dumblevel_del_line): Call
 	_dumblevel_before_del().
	* libdumblevel/alloc.c (dumblevel_new_vertex,
 	dumblevel_new_sector, dumblevel_new_side, dumblevel_new_line):
 	Call _dumblevel_after_new().
	* libdumblevel/observer.c: New file.
	* libdumblevel/dumblevel.h: Add observer stuff.

Fri Apr 24 19:39:19 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumblevel/doomwad.h: New file.
	* libdumblevel/hexenwad.h: New file.
	* libdumblevel/loaddoom.c: Use doomwad.h instead of
 	libdumbwad/wadstruct.h.

Thu Apr 23 16:38:31 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* test/ldltest.c (queue_op): Rename from add_op_node().
	(parse_args): Extend --version output.

	* acinclude.m4: Add gettext macros and a notice that they aren't
 	used yet.

	* libdumblevel/savedoom.c: New file.

Wed Apr 22 10:59:01 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* test/ldltest.c: Mark translatable strings.

	* dumb/renderc.h (INFINITE_SECTORS): New #define.  Not defined by
 	default.
	* dumb/rendcore.h (do_walls) [INFINITE_SECTORS]: Support them.

Mon Apr 20 14:06:09 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumblevel/loaddoom.c (lookup_doom_walltex): Return NULL if
 	name is "" or "-".

	* libdumblevel/initfini.c (init_alloc): Initialize
 	alloc->first_used.

	* test/: New directory.
	* test/fixed_bm.c: Move from tool/.
	* test/ldltest.c: New file.

	* libdumblevel/private.h: New file.
	* libdumblevel/detach.c: New file.
	* libdumblevel/del.c: Maintain doubly-linked lists.
	* libdumblevel/lineprop.c (dumblevel_set_line_side): Detach both
 	old and new sides with no error.

	* Applied dumb-patchsearch.diff from Josh Parsons.
	* libdumbwad/wadio.c (safe_lookup_lump): Look for another start if
 	end-marker occurs before the lump being looked for.

Sun Apr 19 16:04:08 1998  Josh Parsons  <josh@coombs.anu.edu.au>

	* dumb/thinghit.c: Renamed perform() to perform_lta(), and put
	a prototype in dumb/linetype.h

	* dumb/updmap.c: Sectortypes implemented.

	* doom/sectortypes.pt: Entries for all Doom (and Heretic?)
	sectortypes.  Not all are tested.

Sun Apr 19 00:09:33 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* xwad/connect.c (mkvxy) [USE_LIBDUMBLEVEL]: Use
 	dumblevel_new_vertex().
	(mksect, cpysect) [USE_LIBDUMBLEVEL]: Use dumblevel_new_sector().
	(mkside) [USE_LIBDUMBLEVEL]: Use dumblevel_new_side().
	(mkline, mkline2s, cpyline) [USE_LIBDUMBLEVEL]: Use
 	dumblevel_new_line().
	(find_lines_at_vertex, find_sel_lines) [USE_LIBDUMBLEVEL]: Always
 	return 0 until I get this fixed.

	* xwad/xwad.c (init_instance) [USE_LIBDUMBLEVEL]: Use
 	dumblevel_init() instead of arrays.
	(free_instance) [USE_LIBDUMBLEVEL]: Use dumblevel_fini() instead
 	of arrays.
	(load_instance) [USE_LIBDUMBLEVEL]: Use dumblevel_init_doom()
 	instead of direct access.  Use inst->level.vertices[0] instead of
 	inst->ver[0].
	(maxsel) [USE_LIBDUMBLEVEL]: Get counts from libdumblevel.
	* xwad/xwad.h (USE_LIBDUMBLEVEL): New macro.
	(struct AppInstance) [USE_LIBDUMBLEVEL]: Use struct dumblevel
	instead of normal members.

	* xwad/xwadmap.h (GRIDIFY): Always round to nearest multiple of
 	inst->gridsize.

	* libdumblevel/dumblevel.h: New file.
	* libdumblevel/initfini.c: New file.
	* libdumblevel/prop.c: New file.
	* libdumblevel/loaddoom.c: New file.
	* libdumblevel/alloc.c: New file.
	* libdumblevel/del.c: New file.
	* libdumblevel/lineprop.c: New file.

	* dumb/rendcore.h (draw_wall_segment, draw_sky_segment)
 	[USE_RENDERER_DEBUG_FLAGS]: Do that.

	* dumb/render.h (renderer_debug_flags): Declare.
	* dumb/rendcommon.c: New file.
	* dumb/Makefile.am (core_sources): Add rendcommon.c.

	* dumb/render.h (INIT_RENDERER_SPEC, RESET_RENDERER_SPEC,
 	RENDER_SPEC): Rewrite as typedefs INIT_RENDERER_FN,
 	RESET_RENDERER_FN, RENDER_FN.
	* dumb/dumb.c (main): Use the typedefs.

	* dumb/dyncode.h (ThingCode): Add flags member.
	* dumb/dyncode.c (DECL_ENCODE(Thing)): Encode flags.
	(DECL_DECODE(Thing)): Decode flags.
	* dumb/levdyn.h (ThingDyn): Add flags member.
	(THINGDF_NOCLIP): New.
	* dumb/updthing.c (update_things): Check THINGDF_NOCLIP.
	* dumb/game.c (process_input): Add cheat key 5.
	* dumb/netplay.h (PROTOCOL_VERSION): Bump to 2.

Sat Apr 18 15:53:52 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/rendcore.h (do_walls): Don't clip top to pstart2 if the
 	back sector has sky ceiling.
	(draw_wall, do_walls): Don't clip top to pend2 if the front sector
 	has sky ceiling.
	(draw_wall_segment, draw_sky_segment): Change error messages.

	* libdumbworld/, libdumbrender/: New subdirectories.

	* docs/contrib.html: Rewrite contrib.txt in HTML.
	* docs/source.html: Rewrite source.txt in HTML.

Fri Apr 17 18:00:38 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/Makefile.am (EXTRA_DIST): Remove README.textures.  Add
	contrib.txt and source.txt.  Rearrange.

	* docs/README.textures: Remove.

	* docs/configure.txt: Doc fix.

	* docs/contrib.txt: New file.
	* docs/source.txt: New file.
	* README: Doc fix.

	* docs/log-classes: Rewrite.

Thu Apr 16 20:17:03 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/Install-FAQ: New file.
	* docs/Makefile.am (EXTRA_DIST): Add Install-FAQ.

	* xwad/Makefile.am (INCLUDES): Add again.

	* libdumbutil/safeio.c (fname_has_directory): Separate from
 	safe_open_path().  Don't search the path if the filename contains
 	a slash.  Used to check the first character only.  [__MSDOS__]
 	Check for backslash and colon too.

	* configure.in: Update version number to 0.12.2.

Sat Apr 11 09:58:39 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.12.1.

	* dumb/aalib_input.c (get_input): Never change supports_release.
  	Don't call isupper() and islower() if the event isn't a character.
	(init_input): Initialize supports_release based on current AA-lib
 	keyboard driver flags.

	* libdumbutil/safeio.c, libdumb/prothing.c, dumb/levdyn.c,
 	dumb/updmap.c: Change all occurrences of "???" to "?\?\?" to avoid
 	trigraph interpretation.

	* libdumbutil/safeio.c (safe_open_path): Treat the path as empty
 	if it exists (path!=NULL) but has no directories (path[0]==NULL).

	* dumb/unix_net.c (udp_recpkt): Change type of sialen from int to
	size_t.  Reported by rhogan@mnsi.net.

	* docs/dumb-0.12.1.lsm: Rename.  Doc fix.

	* TODO: Move from docs/TODO.

	* dumb/dumb.c (mainconf): New entries: wadpath, doom-wad,
 	doom2-wad, doom4dum-wad.
	(main): Get IWAD filenames from the configuration system.

	* libdumbwad/wadio.c (WadFile): Make fname a pointer.
	(reset_wad): Free wad->fname.
	(check_sanity): Remove parameter fname.  Use wad->fname instead.
  	Rewrite error messages.
	(load_wad): Get wad->fname from safe_open_path().  Use wad->fname
	in messages.
	(init_iwad, init_pwad): New parameter path[].  All callers changed
	to pass NULL if nothing else.
	* dumb/dumb.c (main): Give cnf_wadpath to init_iwad() and
 	init_pwad().

	* libdumbutil/safeio.h: Include <limits.h>.

	* libdumbwad/wadio.c (O_BINARY): Always define unless already
 	defined, even in __MSDOS__.

	* configure.in: Use DUMB_SYS_SHMAT_RMID and define
 	DUMB_CONFIG_SYS_SHMAT_RMID.
	* acconfig.h (DUMB_CONFIG_SYS_SHMAT_RMID): New.
	* dumb/x11_video.c: Use DUMB_CONFIG_SYS_SHMAT_RMID instead of
 	NO_SHMAT_RMID.

	* libdumbutil/safeio.c (safe_mmap, safe_munmap, safe_read,
 	safe_open, safe_close): Use strerror().
	(safe_open): Give open() a file mode parameter.

	* xwad/savemap.c, xwad/xwad.c: Use HAVE_FORK instead of NO_FORK.
  	* libdumbutil/safeio.c, libdumbwad/wadio.c: Use HAVE_MMAP instead
 	of NO_MMAP.

	* tool/wadtool.c (catwad): Change int i to unsigned lumpnum.

	* doom/Makefile.am (PLAYPAL.lump): Use $(DUMB_CONFIG_DOOM_WAD)
	directly instead of $<.
	* htic/Makefile.am (PLAYPAL.lump): Use $(DUMB_CONFIG_HERETIC_WAD)
	directly instead of $<.

	* docs/TODO: Doc fix.

	* configure.in (CPPFLAGS): Include $X_CFLAGS right here.
	* dumb/Makefile.am, xwad/Makefile.am: Don't refer to X_CFLAGS.

	* README: Nowadays we need Automake 1.3.
	* libdumb/Makefile.am (MKDEP), dumb/Makefile.am (MKDEP),
 	tool/Makefile.am (MKDEP), doom/Makefile.am (CXXCPP),
 	htic/Makefile.am (CXXCPP): Remove.  Not necessary with Automake
 	1.3.

	* dumb/le32_fbrerend.c (fbrerender8, fbrerender16): Move
 	"register" to beginning of declaration.

	* tool/Makefile.am (INCLUDES), ptcomp/Makefile.am (INCLUDES),
	xwad/Makefile.am (INCLUDES), libdumb/Makefile.am (INCLUDES),
	libdumbwad/Makefile.am (INCLUDES), libdumbutil/Makefile.am
	(INCLUDES): Don't use +=.

	* configure.in: Look for doom*.wad instead of doom{,1,2}.wad, and
 	look in $datadir/doom/, $datadir/dumb/, /usr/local/games/lib/,
 	/usr/games/lib/, /usr/local/share/doom/, /usr/share/doom/,
 	/usr/local/share/dumb/ and /usr/share/dumb/ too.  Don't accept
 	doom4dum.wad.  Don't AC_DEFINE_UNQUOTED DUMB_CONFIG_DOOM_WAD.
  	Similarly for heretic*.wad.
	* acconfig.h: (DUMB_CONFIG_DOOM_WAD, DUMB_CONFIG_HERETIC_WAD):
 	Remove.

Wed Apr  8 11:13:15 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.12.

	* dumb/renderc.h (add_wall_events): Always assign event->texxofs
 	and event->texyofs.  Assign event->sidenum just once.

	* doom/weapons.pt (Gettable BerserkFist): Join with Gettable
	Berserk from doom/gettables.pt.  Make local to level.
	* doom/gettables.pt (Proto Berserk): Get only 1 of Berserk.  Move
 	to doom/weapons.pt.

	* configure.in: Temporarily add $X_CFLAGS to $CPPFLAGS when
 	looking for extension headers.

	* configure.in: Look for the C++ preprocessor.
	* doom/Makefile.am, htic/Makefile.am: Use $(CXXCPP), not $(CPP).

	* tool/dark2trans.c: Wrap #include <ppm.h> in extern "C" if
 	compiling as C++.

	* libdumbutil/safem.c: Use #ifdef HAVE_MMAP, not #ifndef NO_MMAP.
	(safe_vcalloc): Use MAP_NORESERVE if available.  Always use
 	DEV_ZERO if MAP_ANONYMOUS isn't defined.  Compare mmap() result to
 	MAP_FAILED, not NULL.  Use strerror().
	(safe_vfree, safe_realloc): Use "%p" and strerror().
	(safe_malloc, safe_calloc, safe_strdup): Use strerror().

Mon Apr  6 10:04:53 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* doom/monsters.pt (Proto Baron): Increase damage from 2 to 20.
	* doom/missiles.pt (Proto BaronFireBall): Increase damage from 7
 	to 15.

	* doom/Makefile.am, htic/Makefile.am: Make pt_preprocess use
 	$(CPP).

	* ptcomp/: New directory.
	* Makefile.am (SUBDIRS): Add ptcomp.
	* configure.in (AC_OUTPUT): Add ptcomp.
	* tool/ptcomp.c: Move to ptcomp/ptcomp.c.
	* tool/Makefile.am (bin_PROGRAMS): Remove ptcomp.
	* ptcomp/ptcomp.c (main): Use perror().  Return EXIT_FAILURE if
 	failed to open some file.
	* ptcomp/parm.c (speed_units): Change error message.
	(parm_str, parm_msg): Change type of string length to size_t.
	* ptcomp/soundcomp.c (soundcomp): Rename from secomp().

	* libdumb/gettablestruct.h (_spare1): Rename to weaponnumber.
	(_spare2): Split to replaceweapon and _spare2.
	* doom/weapons.pt: Replace _WeaponNumber and _ReplacesWeapon
	macros with keywords WeaponNumber and ReplaceWeapon.
	* tool/ptcomp.c (gettcomp): Support WeaponNumber and ReplaceWeapon.

Sun Apr  5 08:20:22 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* tool/ptcomp.c (gettcomp): Remove dead code.

	* dumb/bangbang.c (thing_shoot): Separate parameter arc to
 	horiz_arc and vert_arc.
	* libdumb/prothingstruct.h (ProtoThing): Separate shootarc to
 	shootarc_h and shootarc_v.
	* tool/ptcomp.c (protocomp): Extra parameter in ShootMany.  Clear
	shootarc_v in ShootPara.
	(parm_arc_opt): New function.
	* doom/weapons.pt (Proto HeldSuperShotgun): Add vertical arc in
 	ShootMany.

	* docs/README.ptcomp: Doc fix.

	* dumb/linetype.h (struct LineTypeOffsets): New structure.
	(ltofs): New variable.

	* libdumb/linetypestruct.h (LineType): Add scrolldx, scrolldy.
	(LT_SCROLL): New macro.
	* tool/ptcomp.c (speed_units): Accept and skip sign in s.
	(ltcomp): Support "Scroll".
	* dumb/linetype.c (init_ltscroll, linetype_ticks_passed): New
 	functions.
	(struct LineTypeOffsets): New structure.
	(ltofs, scrollers, nscrollers): New variables.
	* dumb/dumb.c (main): Call linetype_ticks_passed().

	* doom/linetypes.pt (Floor-W1L-UpNext-TX): Rename to
 	Floor-W1L-UpNext-TXP and change FloorTexture to FloorType.  This
	is used in Doom's E1M5 for a bridge rising from slime.

	* dumb/game.c (process_input): Support switching to previous weapon.
	* dumb/gettable.c (rotate_selection): New parameter DIR.  All
 	callers changed.  Wrap in both directions.

	* docs/dumb-0.12.lsm, docs/FAQ, docs/autoconf: Doc fixes.

	* docs/autoconf: Rename to docs/configure.txt.

	* tool/Makefile.am (bin_PROGRAMS): Install mkpnames.

	* doom/weapons.pt: Add "Phases Fist".

Fri Apr  3 12:27:18 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in: Make nonexecutable.  Fix gethostbyname() error
 	message.

Thu Apr  2 21:21:38 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* doom/weapons.pt (_ReplacesWeapon): New no-op macro.
	(Proto BerserkFist): New.
	(Gettable Fist): New.
	(Gettable BerserkFist): Rename from BrassKnuckles.  Initial 0.
	Use _ReplacesWeapon.  Change message.
	(Gettable Chainsaw): Use _ReplacesWeapon.

	* doom/weapons.pt (_WeaponNumber): New no-op macro.
	(Gettable BrassKnuckles, Chainsaw, Pistol, Shotgun, SuperShotgun,
	Chaingun, RocketLauncher, PlasmaRifle, BFG): Add weapon numbers.

	* configure.in: Bump version number to 0.12.

1998-04-02  Kalle Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.12.beta2.

	* acinclude.m4 (DUMB_SCAN_LIBS): New macro.
	* configure.in: Check AC_PATH_X and AC_PATH_XTRA before other
	libraries.  Use -lncurses and x libraries when looking for aalib.
	Look for socket() and gethostbyname() in special libraries.

	* tool/ptcomp.c (parm_dbl): Change return type to double (was int).

	* libdumbutil/endiantypes.h: Don't give an error message about
	non-C++ compilation.  The compiler will do that.
	* dumb/linux_video.c: Don't check if linux is defined.

Thu Apr  2 00:33:19 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/updmap.c (unqueue_all_events): New function.
	* dumb/dumb.c (main): Call unqueue_all_events() before loading
	next level.

	* dumb/dumb.c (game_want_newlvl): Rename parameter to secret.

	* acinclude.m4 (DUMB_MSG_REQUIRE): Rewrite without "if !".

	* configure.in: Remove initial #! /bin/bash (how did it ever get
 	there?)

Wed Apr  1 16:52:42 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* doom/levels.pt (E1M9, E2M9, E3M9, E4M9, MAP32): Make the secret
 	exit (which doesn't really exist but can be taken with a cheat
 	key) lead back to the normal game just like the normal exit.

Tue Mar 31 13:57:21 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Released 0.12.beta1.

	* dumb/dumb.c (main): Apply xmul patch from Marcus Sundberg:
	Test (xmul==1 && ymul==1) instead of ((xmul & ymul) == 1).
  	Allocate rendfb with size real_width/xmul*height*bpp instead of
 	width*height*bpp.  Call init_renderer(), init_draw() and
 	fbrerender() with real_width/xmul instead of real_width.  Check if
 	getlump("WAFFLE")==0.

	* dumb/unix_net.c (udp_init_station): Allow HOST:PORT.  Default to
	cnf_udp_port if PORT is not given.

Mon Mar 30 01:26:08 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/linux_input.c (KALLE_KEYS): New macro.
	(get_input) [KALLE_KEYS]: Use my keys.

	* configure.in: Change version number to 0.12.beta1.

	* dumb/dumb.c (main): Open snapshot.ppm as binary.  (Shouldn't
 	have any effect on POSIX systems)

	* dumb/thinghit.c (perform_666): Move to LowestAdjacentFloor, not
 	HighestAdjacentFloor.

	* dumb/ggi_video.c (handle_ggi_key_event) [KALLE_KEYS]: Check
 	K_ASC* keys (assuming Alt+numpad gives these).

Sun Mar 29 16:47:18 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/ggi_video.c: Add Local Variables section.
	(KALLE_KEYS): New macro.
	(handle_ggi_key_event) [KALLE_KEYS]: Very different keymap.
	(handle_ggi_ptr_event, update_continuous_actions) [KALLE_KEYS]:
 	Strafe with Alt, not Ctrl.

	* docs/ifnames: Remove.
	* docs/Makefile.am (EXTRA_DIST): Remove ifnames.

Sat Mar 28 04:23:58 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/keymap.txt: Almost rewritten.
	* dumb/keymap.c: Move long blurb to docs/keymap.txt.

	* tool/ptcomp.c (phasecomp): Add NoGlow, NoDestroy, Sigs,
 	NoStrategy, NoHeatSeek, NoShoot, NoExplode, NoMelee, NoSpawn2,
 	NoRSpawn2, NoIdle, NoBFGEffect and NoSpawn for use in Default.

	* doom/weapons.pt (PhaseTable HeldChainsaw): Make faster.

	* dumb/keymap.c (keymap_defaults): Add bindings for "k", "j", "h",
	"l", ",", ".", "d", "c" and "Shift".

	* data/WADINFO: Remove as unused.
	* data/: Remove as empty.

	* dumb/aalib_input.c (ticks_shift_held): New variable.
	(SHIFT_KEYCODE): New macro.
	(init_input): Move initialisation of variables here.
	(get_input): Check for shift with isupper() and islower().  Update
	and use ticks_shift_held.

	* dumb/x11_video.c (grab_choices): Make const.

	* dumb/aalib_video.c (mypal): Rename to graypal.
	(USE_FASTRENDER): Rename to ALLOW_FASTRENDER.
	(dither_choices): New array.
	(video_conf): New entries for --vid-fastrender, --vid-bright,
	--vid-contrast, --vid-gamma, --vid-dither and --vid-randomval.
	(cnf_fastrender, cnf_bright, cnf_contrast, cnf_gamma, cnf_dither,
 	cnf_randomval): New macros.
	(aapal, aarp): Define even with ALLOW_FASTRENDER.
	(init_video): Use cnf_* macros instead of constants
	(video_setpal): Always call aa_setpalette().

Fri Mar 27 12:27:27 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/keyname.c, dumb/keyname.h: New files.

	* dumb/dummy_video.c (init_video): Set *real_width.

	* dumb/fbrerend.h: Add include guard.  Include render.h.

	* dumb/keymapconf.h (KEYMAPCONF_DEFS): Remove.
	* dumb/keymapconf.c (keymap_conf): New variable.
	(keymapconf_after_load): Rename from
	keymapconf_interpret_all().  Check if keymap is empty.
	(keymapconf_before_save): Rename from keymapconf_make_all().
	* dumb/x11_video.c (init_input, reset_input): Don't do anything
 	with keymap.
	* dumb/aalib_input.c (init_input, reset_input): Don't do anything
	with keymap.
	* dumb/dumb.c (main): Add keymap and keymapconf calls.

Thu Mar 26 02:13:59 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* configure.in: Add --with-doom-wad and --with-heretic-wad
	options.
	* acconfig.h (DUMB_CONFIG_DOOM_WAD, DUMB_CONFIG_HERETIC_WAD):
	New.
	* doom/Makefile.am: Use DUMB_CONFIG_DOOM_WAD if it is set.

	* Apply Solaris patches from <richardp@scopic.com>:
	* dumb/unix_net.c (udp_init): Add cast to (const char *) in
	setsockopt() call.
	* libdumbutil/safem.c: #define MAP_ANONYMOUS as 0 if not defined
	by headers.
	* xwad/drawmap.c (FRONT, BACK): Add casts to int.

Wed Mar 25 15:43:59 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/aalib_input.c: Use keymap.  Autorelease.

	* */*.[ch]: Replace }; with } where possible.

Wed Mar 18 15:26:41 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/netio.c, dumb/netplay.c: Change #include <strings.h> to
	#include <string.h>.

Mon Mar 16 16:04:24 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* libdumb: New directory.  The intent is to move here those files
	from dumb/ that ptcomp, XWad and XProtoThing need.
	* dumb/texture.c: Move to libdumb/texture.c.
	* dumb/texture.h: Move to libdumb/texture.h.
	* dumb/pastepic.c: Rename to libdumb/pastepic.h.

	* lib: Rename to libdumbutil.  This library contains general
 	functions that DUMB uses but which could be used in other programs
 	too.
	* wad: Rename to libdumbwad.  This library contains WAD file
 	handling functions that DUMB uses but which could be used in other
 	programs too.

	* lib/endian.h: Rename to lib/endiantypes.h to avoid clash with
 	system-defined <endian.h> when -I. is given.

	* Begin automake project.  This version is 0.11.kn.2.

Mon Mar 16 14:05:55 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Synchronize with DUMB 0.11.
	* dumb/dumb.c (VERSION): Update to 0.11.kn.1.
	* docs/CHANGES.Niemitalo: Add notification that 0.11 contains most
	of pre0.11.kn.1.

	* docs/ifnames: Regenerate.

Sun Mar 15 21:09:28 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	This version is pre0.11.kn.2.  Josh has published 0.11 which
 	contains most of pre0.11.kn.1.  Now I'm going to make diffs and
 	merge my changes with it.

	* Makefile.in (TAGS): Build separate TAGS files for tool/ and
 	xwad/ because they have clashing identifiers.  Make TAGS a phony
 	target so it can be updated without deleting it first.
	(distclean): Delete tool/TAGS and xwad/TAGS.

	* lib/conf.c (set_conf, conf_args): Apply patches from Josh.  They
	fix (some of?) the bugs I caused.

	* xwad/connect.c: Add Local Variables section.
	(find_lines_at_vertex, find_sel_lines, crossing_point,
 	cross_lines, cross_sel_lines): New functions.
	* xwad/xwadctls.c, xwad/connect.c (join_lines_at_vertex): Move
 	function to xwad/connect.c.
	(join_lines): Proxy for join_lines_at_vertex().
	(linemode_ctls): New button "Crossing" for line_crossing().  It
 	breaks two lines at the point where they intersect.  WARNING: If
 	the lines are parallel, this may cause division by zero and crash.
	* xwad/xwad.h (join_lines_at_vertex, cross_sel_lines): Declare.

Sat Mar 14 21:06:28 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (VERSION): Update to pre0.11.kn.2.

	* plat/ctlkey_input.c, plat/ctlkey_input.h, plat/keymap.c,
	plat/keymap.h, plat/keymapconf.c, plat/keymapconf.h: Update
	address of Free Software Foundation.  This one was on www.fsf.org
	so it should be current.

	* docs/CHANGES.Niemitalo: Add synchronisation/patch notice to
 	yesterday's changes.

	* xwad/xwadctls.c (del_line): Copy algorithm from del_thing().
	Deleting multiple lines should now work.

	* xwad/xwadctls.c (join_lines_at_vertex): New function.  Its body
	should probably be moved to connect.c.
	(vermode_ctls): New control JoinLines.

Fri Mar 13 16:23:55 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	This version has routines for saving the keymap to .dumbrc and
	loading it back.  Only the X11 input driver uses my keymap system
	so far.  So, if you are using X11, now you can finally edit the
	keymap in the configuration file.

	* Synchronize with DUMB pre0.11 by applying patches from Josh
 	Parsons, the author of DUMB: dumb-0.10a-pre0.11.diff.gz,
 	dumb-configure.in.diff.gz,
 	dumb-pre-0.11-netplay-alignment.diff.gz.

	* dumb/dumb.c (VERSION): Update to "pre0.11.kn.1".

	* dumb/dumb.c (main): Remove "Can't find player" check.  There's
	one in dumb/levdata.c.

	* Makefile.in (Makefile): New target.
	* configure.in (@DUMB_CONFIGURE_WAS_RUN@): New substitution.

	* Makefile.in (DEFS): Separate from PLATFLAGS to avoid telling
 	makedepend about X include directories.
	(DEPFLAGS): New variable.
	(depend): Use DEPFLAGS, not CFLAGS.
	* Makefile.in: Update dependencies.

	* Makefile.in (XDUMB_OBJS): Add plat/keymapconf.o.

	* Makefile.in (distclean): Revise comment.  Rearrange.  Add
 	executables.
	(docs/ifnames): Simplify header.

	* aclocal.m4: New file.  Move feature test macros here from
 	configure.in.
	* Makefile.in (SRCDIST_STUFF): Add aclocal.m4.

	* lib/conf.h: Add Local Variables section.
 	(enum conf_type): New.
	(ConfItem): Separate type from flags.  Rearrange.
	(CI_LIST, CI_INT, CI_STR, CI_BOOL, CI_ENUM): Delete.
	(CONFE, CONFI, CONFS, CONFL, CONFB, CONFNB, CONFNS, CI_NOSAVE):
 	Update.
	(conf_clear_list): Declare.
	* lib/conf.c: Comment many functions.  Add Local Variables section.
	(find_conf_file): Check !s[0].
	(load_conf): Look at type, not flags.
	(modhelp, swhelp, set_conf): Rearrange with switch.
	(lookup_etype): Complain if the word given isn't found in the
 	list.
	(set_conf): Always strdup list entries.
	(conf_clear_list): New function.

	* lib/endian.h (IB): Correct return value.  Was (int)i.

	* plat/ctlkey_input.c (recalc_input): Check if
	UNIT_SPEED==INT_TO_FIXED(1).
	(compress_square_to_circle): Add diagram.

	* plat/keymap.c (keymap_install_defaults): Publish.
	(keymap_init): Don't call keymap_install_defaults().
	(keymap_reset): Don't call keymap_debug_dump().
	(keymap_is_empty, keymap_foreach_binding): New functions.
	(keymap_debug_dump): #if 0.
	* plat/keymap.h (keymap_is_empty, keymap_install_defaults,
	keymap_foreach_binding): Declare.
	* plat/keymapconf.c, plat/keymapconf.h: New files.
	* plat/x11_video.c (input_conf): Include KEYMAPCONF_DEFS.
	(FIRST_KEYMAPCONF_ENTRY): New macro.
	(init_input): Interpret the keyboard configuration and install
	defaults if empty.
	(reset_input): Convert the keymap to lists for saving.

Fri Mar  6 14:18:37 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (VERSION): Update to "0.10a.kn.4".

	* lib/safem.c: Add Local Variables section.
	(safe_strdup): New function.
	* lib/safem.h: Declare safe_strdup().  Change comment.

	* plat/ctlkey_input.c, plat/ctlkey_input.h, plat/keymap.c,
 	plat/keymap.h: Add lengthy license notices.  WARNING: FSF's
	address may be old.

	* plat/ctlkey_input.c (recalc_input): Use x,y right from the
 	beginning, and declare them as fixed-point.

	* plat/keymap.c: Update initial comments.  Perhaps they should be
 	moved to docs/keymap.txt.
	(struct keymap_entry): Rename to struct keymap_binding.  Shuffle
 	contents.
	(struct keymap_default_binding): New structure.
	(keymap_clear_caches): Make public.
	(keymap_install_defaults, keymap_bind_key, keymap_new_binding,
 	keymap_del_binding, keymap_set_capacity): New functions.
	(keymap): Now a pointer to a dynamically allocated array.  The old
 	static list is now called keymap_defaults[].
	(keymap_length, keymap_capacity): New variables.
	(keymap_init): Reset new variables and call
 	keymap_install_defaults(), not keymap_clear_caches().
	(keymap_reset): Free the keymap and its contents.
	(keymap_keycode_to_ctlkey): Rename local variable "p" to
 	"binding".  Complain if keymap_keycode_to_keyname() returns NULL.
	(keymap_clear_caches, keymap_find_keycode, keymap_find_keyname,
 	keymap_debug_dump): Terminate loop on i>=keymap_length, not
 	p->action==CTLKEY_NONE.
	(keymap_press_keycode): Call ctlkey_press() even if
 	ctl==CTLKEY_NONE.
	* plat/ctlkey_input.c (ctlkey_press): Allow key==CTLKEY_NONE.
	* plat/ctlkey_input.h (ctlkey_press): Say that CTLKEY_NONE is
	allowed.
	* plat/keymap.h (keymap_clear_caches, keymap_bind_key): Declare.

	* plat/keymap.c, plat/keymap.h: Separate and document the input
	driver and configuration interfaces.

Thu Mar  5 18:41:00 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (VERSION): Update to "0.10a.kn.3".

	* plat/x11_video.c (handle_crossingevent): Comment out logprintf()
	calls.

	* plat/keymap.c, plat/keymap.h: New files.
	* plat/x11_video.c (handle_keyevent): Replace long switch with a
	call to keymap_press_keycode().
	(init_input): Call keymap_init(), not ctlkey_init().
	(reset_input): Call keymap_reset(), not ctlkey_reset().
	(keymap_keycode_to_keyname): New function.
	* Makefile.in (XDUMB_OBJS): Add plat/keymap.o.

	* Makefile.in (TAGS): New target.
	(distclean): Add TAGS to list of removed files.

	* docs/TODO: Add "Uff!"

	* dumb/updthing.c: Add Local Variables section.
	(update_things): Add "fixed factor" in staircase part.
	* docs/TODO: Remove comment about walking backwards in stairs.

	* plat/ctlkey_input.h: Fix confusing comment.

	* Makefile.in: Rerun make depend after configuration and copy the
 	updated dependencies here.  But remove system header dependencies.
  	Uh.  That was painful and error-prone.  Probably I shouldn't have
 	started that at all.

Thu Mar  5 13:29:14 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile.in (BINARIES): Remove $(GAME).wad.

	* docs/ctlkey.txt: Rename to docs/keymap.txt.

	* plat/x11_video.c: Consistently reindent to tab=3 and remove
 	semicolons after closing braces.
	(enum grab_choice_enum, grab_choices): Rename when-focused to
 	when-pointed.  See comment near handle_crossingevent().
	(handle_keyevent): New function.  Separated from get_input().
	(handle_crossingevent): New function.
	(grab_keys, ungrab_keys): New functions.  Use instead of calling
 	XGrabKeyboard() and XUngrabKeyboard() directly.

	Reasons for all those changes in plat/x11_video.c: I liked
 	--vid-grab-focus because it let me use Alt+arrow keys for strafing
 	without the window manager switching between virtual screens all
 	the time.  But I hated it when I couldn't switch back to Emacs and
 	type.  So I made the switch have three states (never,
 	when-focused, always) with "always" being the default as before.
  	And I renamed the switch to --input-grab-kbd because it affected
 	input rather than video.  But then I got trouble implementing the
 	"when-focused" state, decided to base it on the mouse pointer
 	location instead of the real focus and renamed it to
 	"when-pointed".

	Old option             New option
	--vid-grab-focus 0     --input-grab-kbd never
	N/A                    --input-grab-kbd when-pointed
	--vid-grab-focus 1     --input-grab-kbd always

	* docs/TODO: Add one wish about conf.c.

Wed Mar  4 18:49:00 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (VERSION): Update to "0.10a.kn.2".

	* docs/ctlkey.txt: New file.
	* plat/ctlkey_input.c (ctlkey_name): Rename to ctlkey_names[],
	move near bottom of file and add ugly names.
	(struct ctlkey_namepair): New structure.
	(ctlkey_ugly_name, ctlkey_pretty_name): New functions.
	* plat/ctlkey_input.h (ctlkey_name): Remove.
	(ctlkey_ugly_name, ctlkey_pretty_name): Declare new functions.

	* plat/x11_video.c (video_conf, input_conf): Move "grab-focus"
 	from video_conf[] to input_conf[] and rename it to "grab-kbd".
  	Change all references.  Make it enumerated with three values:
 	never, when-focused, always.
	(grab_worked): Rename to "grabbed".
	(init_video): Set grabbed=1 only if it really worked.

Wed Mar  4 10:34:32 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Synchronize with DUMB 0.10a.  Piece of cake.
	* dumb/dumb.c (VERSION): Update to "0.10a.kn.1".
	* pre-ac/Makefile: Copied from Makefile of DUMB 0.10a.

	* Makefile.in (docs/ifnames): New target.
	* docs/ifnames: Regenerate.

	* docs/#README.netplay#: Remove.

Wed Mar  4 09:41:58 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (VERSION): Update to "0.09.kn.4".  I will not
 	distribute this version because Josh has already released 0.10a.

	* Makefile.in (SRCDIST_STUFF): Replace "Makefile" with "configure
	configure.in Makefile.in".  Divide to two lines with a backslash.
	(distclean): New target.

	* configure.in (--disable-16bit-sound, --disable-stereo-sound):
	New options.
	* docs/autoconf: Documented the new sound options.

Tue Mar  3 14:56:03 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Makefile, pre-ac/Makefile: Move old Makefile to the pre-ac
 	directory.  Instead of using it, you should run configure, which
	produces the Makefile from Makefile.in.
	* Makefile.in: New file.
	* configure: New file.
	* configure.in: New file.

	* docs/autoconf: New file.
	* docs/ifnames: New file.

	* docs/CHANGES.Niemitalo: Add "Rerun make depend" to previous
 	changes.

	* render/render.c (//#define CHK_ACTIVE_COUNT): Remove trailing S
	to make the name match the #ifdefs.  Still commented out however.

Wed Feb 18 16:58:54 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* dumb/dumb.c (VERSION): Update to "0.09.kn.3".
	* docs/CHANGES.Niemitalo: Fix lower-case "version" in yesterday's
 	changes.

	* Makefile: Rerun make depend.

	* doom/weapons.pt: Rearrange to match DOOM weapon numbering.

	* dumb/prothing.h (PT_TURNWHENHITTING): New.
	* dumb/thingm.c (do_melee_damage): Add support for
	PT_TURNWHENHITTING.
	* tool/ptcomp.c (protocomp): Add support for TurnWhenHitting.
	* doom/weapons.pt (Proto HeldChainsaw): Add TurnWhenHitting.

	* doom/gettables.pt (Proto Soulsphere): Gets Health 100, not 200.

	* docs/TODO: Add a few wishes.

	* plat/x11_video.c (init_video): Move shm predeletion to correct
 	place.  It was in the wrong branch of an "if" and the segments
	weren't being deleted at all.  My fault.

	* dumb/texture.c (paste_pict_on_texture, paste_jpatch_on_texture):
	Correct "BBP" to "BPP" in error messages.

	* render/slice86.c (PIXEL_GUARD_VAL): New, copied from slice.c.
	(draw_trans_slice): Change type of "p" from Pixel to TPixel.  Use
 	PIXEL_GUARD_VAL (which is always 255) instead of hex constants.
  	This fixes the bug of partially invisible objects appearing as
	rectangles when BPP>1.
	* render/slice.c: Add comment that slice86.c exists.
	(__draw_transparent_sl): Add comment on unsigned integer overflow
 	behavior specified by C standard.

	* render/slice86.c: Remove semicolons after closing braces and
	excessive trailing newlines.

	* dumb/levdyn.h (THING_MAGIC_JELLYBEAN): Rewrite with offsetof()
 	from <stddef.h>.  WARNING: Network playing not tested.  But it
	should work.

Tue Feb 17 15:56:25 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Synchronize with DUMB 0.09.
	* dumb/dumb.c (VERSION): Update to "0.09.kn.2".

	* dumb/dumb.c (main): Remove my fixed-point looking patch because
 	the looking system seems to have changed.
	* plat/ctlkey_input.c (COMPLEX_LOOKING): New #define.  Not defined
 	by default.
	(ctlkey_press, ctlkey_calc_tick): Add #ifdef COMPLEX_LOOKING.
	(recalc_input): Add #ifdef COMPLEX_LOOKING and assignment inside
 	its #else...#endif.

	* plat/x11_video.c (input_conf): Add entry for use-xkb.
	(use_xkb): No longer a separate variable.
	* tool/ptcomp.c (parm_dbl): Remove.  parm_arc() does a better job.

	* render/rendcore.c (do_walls): My texture-alignment fix didn't
 	work right with transparent textures, just like I feared.  Fixed.

	* plat/x11_video.c (init_video): Remove extra call to
 	XkbSetDetectableAutoRepeat().
	(init_video, init_input): Move call of init_xkb() from
 	init_video() to init_input().

	* tool/ptcomp.c (arc_units): Fix error message.  (was "strange
	timing unit")

	* docs/log-classes: New file.

	* plat/ctlkey_input.c: Add TO DO comment.

Mon Feb 16 00:31:54 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* docs/CHANGES.Niemitalo: Reformat this file to GNU standards.
	Add Local Variables section.

	* dumb/dumb.c (VERSION): Update from 0.06 to 0.06.kn.2.

	* Makefile: Rerun make depend.
	(XDUMB_OBJS): Add plat/ctlkey_input.o.
	* plat/ctlkey_input.c, plat/ctlkey_input.h: New files.
	* plat/x11_video.c: Separate ctlkey stuff as plat/ctlkey_input.c.
	(get_input, init_input, reset_input): Call corresponding ctlkey
 	functions.

	* dumb/dumb.c (main): Convert in.lookup to fixed point and divide
 	it by 8 before dividing it by UNIT_SPEED and passing it to
 	player_apply_lookup().
	* dumb/thingm.c (player_apply_lookup): Change type of parameter
 	LOOKUP from int to fixed and don't divide it by 8.  This allows
 	more precise looking / aiming.

	* lib/log.h: #include <stdarg.h> and <stdio.h>.

	* plat/x11_video.c (NO_XKB, use_xkb, init_xkb): New.
	(get_input): Separate looking and aiming.  They are otherwise
 	alike but when the player releases the look button, the view is
 	automatically centered.  Add CTLKEY_CENTER_VIEW from XK_KP_5 and
 	XK_KP_Begin.

	* tool/ptcomp.c (parm_dbl): New function.
	(gettcomp, protocomp): Angle-ratio parameter to ShootMany is now
 	floating-point to allow 0.5 = full circle.  No changes in output
 	lump format.

Fri Feb 13 22:16:03 1998  Kalle Olavi Niemitalo  <tosi@stekt.oulu.fi>

	* Begin with DUMB 0.06 downloaded from cmbsb78.anu.edu.au.

	* dumb/dumb.c, dumb/levdyn.h, xwad/xwadctls.c: Remove empty lines
 	at end of file.
	* dumb/dumb.c, dumb/levdyn.h, plat/x11_video.c, render/rendcore.c,
 	render/render.c, xwad/xwadctls.c: Add Local Variables sections for
 	emacs.

	* Makefile (BINARIES, XLIBS): Adapt to my system.

	* dumb/dumb.c (main): Change comment to "p = play".  Add "Can't
 	find player" check.

	* x11_video.c (init_video): Mark the shared memory segment for
 	deletion right after attaching to it.  This way it won't be left
 	there when the program crashes.
	(reset_video): No need to delete the shared memory segment second
 	time.  See above.

	* x11_video.c (run_state, strafe_state): Replace with
 	ctlpressed[].
        (get_input): Rewrite keyboard control system.  Now it uses "enum
 	ctlkey" and ctlpressed[] between X keysyms and inp_state.
  	Advantages: easier to add keyboard configuration later; run key
	(shift) works even if pressed after movement key; simpler
 	structure.  Rearrange keys to match those we use here (with
 	dedicated strafe keys in numpad 1 & 3; Alt still works however).
  	Add a square-to-circle compression routine so that diagonal
 	movements aren't any faster than forward ones.  Should rethink
 	this one though... the input state should reflect what the player
 	is trying to do, not what he can do.

	* render/rendcore.c (draw_wall_segment): Converted loop to
	operator % when tex_column < 0.  Previous ways in comments.
	* render/rendcore.c (draw_wall, do_walls): Fixed bug pegging
 	textures to wrong sectors when the floor is higher than adjacent
 	sector's ceiling.  WARNING: should test how well my fix cooperates
 	with transparent textures, objects & sky.
	* render/render.c (Active_wall): Added diagram how
 	p{end,start}{1,2} work.

	* xwad/drawmap.c (line_is_sel): Now returns a bit mask indicating
 	currentness/selection status for each side separately.
	(draw_line): Highlights lines according to bit mask got from
 	line_is_sel().  This is great for clicking sectors and seeing if
 	they are using the correct sides of lines.
	* xwad/xwadctls.c (del_thing): Now uses "packing" algorithm that
 	works faster and better when deleting multiple things.
