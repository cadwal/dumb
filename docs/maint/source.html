<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
	"http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
  <head>
    <title>DUMB source HOWTO</title>
  </head>
  <body>


    <h1>DUMB source HOWTO</h1>

    <p>This corresponds to DUMB 0.13.4.

    <ul>
      <li><a href="#dirs" name="TOCdirs">Directory structure</a>
      <li><a href="#mkver" name="TOCmkver">Updating the version number</a>
      <li><a href="#mkdir" name="TOCmkdir">Adding a new directory</a>
      <li><a href="#mkfile" name="TOCmkfile">Adding a new source file</a>
    </ul>


    <h2><a href="#TOCdirs" name="dirs">Directory structure</a></h2>

    <p>There are some rules on how the directories are built.

    <ol>
      <li>Libraries are built before programs and other libraries that
	need them.
      <li>Most important programs are built first so that <kbd>make
	  install</kbd> lets you play as soon as possible.
    </ol>

    <p>Here's the list:

    <dl>

      <dt>libmissing/
      <dd>Functions that may be missing from system libraries.

      <dt>libdumbutil/
      <dd>Various functions that DUMB uses but which could be used by
	other, very different programs too.

      <dt>libdumbwad/
      <dd>Functions for reading and writing WAD files.

      <dt>libdumbworldb/
      <dd>The database of what exists in a level.  Doesn't include
	functions for monster strategy, explosions or such.
	(Partially implemented.)

      <dt>libdumbrender/
      <dd>(Not yet implemented.)

      <dt>libdumb/
      <dd>Random stuff that is needed by both DUMB and the utility
	programs in the package.

      <dt>intl/
      <dd>The GNU gettext library.  There's nothing DUMB-specific
	here.  So when a new version of gettext is released, you can
	delete this directory and copy the one in the gettext package
	here.

      <dt>dumb/
      <dd>The game engine itself.

      <dt>xwad/
      <dd>Two programs that work under the X Window System.

	<dl>

	  <dt>XWad
	  <dd>A level editor.

	  <dt>XProtoThing
	  <dd>A viewer for protothings.  Protothings define what the
	    thing type numbers mean.

	</dl>

      <dt>ptcomp/
      <dd>A program that compiles .pt source code to binary lumps that
	can then be included in WADs.

      <dt>tool/
      <dd>Various small utility programs.

	<dl>

	  <dt>dark2trans
	  <dd>A filter for ppm-format pictures.  Turns all "dark"
	    pixels to R=0,G=0,B=1 which ppmtodumb recognizes as
	    meaning transparent.  The darkness threshold is given as a
	    parameter.

	  <dt>mkdfnt
	  <dd>Turns X11 fonts to pgm-format pictures which can in turn
	    be converted to DUMB's format and put in WADs.

	  <dt>mknulmap
	  <dd>Generates a map containing just an empty room.

	  <dt>mkpnames
	  <dd>Compiles a textual listing to TEXTURE1 and PNAMES lumps.

	  <dt>ppmtodumb
	  <dd>Converts ppm-format pictures to the format DUMB uses.

	  <dt>wadtool
	  <dd>Copies, builds, extracts and concatenates WAD files.

	</dl>

      <dt>doom/
      <dd>Sources for doom4dum.wad which lets you play Doom and Doom
	II with DUMB.

      <dt>htic/
      <dd>Sources for htic4dum.wad which lets you play Heretic with
	DUMB.

      <dt>test/
      <dd>Programs to check that the libraries work.

	<dl>

	  <dt>fixed_bm
	  <dd>A fixed-point benchmark.  Tests how fast your CPU is.

	  <dt>ldltest
	  <dd>Command-line tests for libdumbworldb.  The library used
	    to be called libdumblevel.  Hence the name.

	</dl>

      <dt>po/
      <dd>Message catalogs for different languages.

      <dt>docs/
      <dd>The incomplete documentation.

	<dl>

	  <dt>dos/
	  <dd>Documentation for the DOS port.

	  <dt>maint/
	  <dd>Documentation on maintaining DUMB.  This file is here.

	</dl>

      <dt>aux/
      <dd>Various files needed by the configure script and Makefiles.

    </dl>


    <h2><a href="#TOCmkver" name="mkver">Updating the version number</a></h2>

    <p>These are the files that you should update when you change
      DUMB's version number:

    <ul>
      <li>configure.in
      <li>NEWS
      <li>ChangeLog
    </ul>

    <p>The version number is also mentioned in the following files but
      in such a way that you don't have to change them if you feel
      lazy:

    <ul>
      <li>README: "You should get a directory called something like
	dumb-0.13.4"
      <li>docs/configure.txt: "In the following, I'll call that
	directory /cdrom/sources/dumb-0.13.4.",
	"/cdrom/sources/dumb-0.13.4/configure"
      <li>docs/maint/contrib.html: "(it probably is, as
	dumb-0.12.tar.gz was just 340k :)"
    </ul>

    <p>After changing the version number in configure.in, run make in
      the build directory.  The change will propagate to configure,
      config.status and config.h and everything will be recompiled.


    <h2><a href="#TOCmkdir" name="mkdir">Adding a new directory</a></h2>

    <p>Do the following in the source directory:

    <ol>

      <li>Make directory foo.

      <li>Create foo/Makefile.am.  It can be empty at this phase but I
	prefer to put one line in it:

	<p><samp>## Process this file with automake to produce
	    Makefile.in</samp></p>

      <li>Add foo in the SUBDIRS definition in the main Makefile.am.
	The order of the directories matters.  So if foo/Makefile.am
	uses ptcomp, foo must come after ptcomp in the list.

      <li>Add foo/Makefile in the AC_OUTPUT statement in configure.in.

    </ol>

    <p>Then in the build directory:

    <ol start=5>

      <li>Run <kbd>make foo/Makefile</kbd>.  This causes
	<tt>aclocal</tt>, <tt>automake</tt>, <tt>autoconf</tt>,
	<tt>configure</tt> and <tt>config.status</tt> to be run, and
	then proceeds to generate <tt>foo/Makefile.in</tt> in the
	source tree and	<tt>foo/Makefile</tt> in the build tree.

    </ol>


    <h2><a href="#TOCmkfile" name="mkfile">Adding a new source file</a></h2>

    <p>Copy the boilerplate from docs/maint/template.c, or use
      docs/maint/dumb-autoins.el which does this (and more)
      automatically.

    <p>Add the name of the file to SOURCES in the Makefile.am of that
      directory.  Or if that isn't appropriate, add it to EXTRA_DIST
      instead.

    <p>When finished with the directory, change to the root of the
      build tree and run "<kbd>make update-po</kbd>".  This scans
      files for translatable strings and updates po/*.po files.


    <address>
      <a href="http://stekt.oulu.fi/~tosi/">Kalle O. Niemitalo</a>
      <a href="mailto:tosi@stekt.oulu.fi">&lt;tosi@stekt.oulu.fi&gt;</a>
    </address>
  </body>
</html>
